<div
  class="code-block code-block-1"
  style="margin: 8px 8px 8px 0; float: left"
></div>
<p>(h/t to reader Koe for providing the first draft of this lesson!)</p>
<p>
  In lesson
  <a href="https://www.learncpp.com/cpp-tutorial/stdmove/">22.4 -- std::move</a
  >, we covered <code>std::move</code>, which casts its lvalue argument to an
  rvalue so that we can invoke move semantics. And in lesson
  <a
    href="https://www.learncpp.com/cpp-tutorial/exception-specifications-and-noexcept/"
    >27.9 -- Exception specifications and noexcept</a
  >, we covered the <code>noexcept</code> exception specifier and operator. This
  lesson builds on both concepts.
</p>
<p>
  We also covered the <code>strong exception guarantee</code>, which guarantees
  that if a function is interrupted by an exception, no memory will be leaked
  and the program state will not be changed. In particular, all constructors
  should uphold the strong exception guarantee, so that the rest of the program
  won’t be left in an altered state if construction of an object fails.
</p>
<p class="cpp-section cpp-topline" style="clear: both">
  The move constructors exception problem
</p>
<p>
  Consider the case where we are copying some object, and the copy fails for
  some reason (e.g. the machine is out of memory). In such a case, the object
  being copied is not harmed in any way, because the source object doesn’t need
  to be modified to create a copy. We can discard the failed copy, and move on.
  The <code>strong exception guarantee</code> is upheld.
</p>
<div class="code-block code-block-2" style="margin: 8px 0; clear: both"></div>

<p>
  Now consider the case where we are instead moving an object. A move operation
  transfers ownership of a given resource from the source to the destination
  object. If the move operation is interrupted by an exception after the
  transfer of ownership occurs, then our source object will be left in a
  modified state. This isn’t a problem if the source object is a temporary
  object and going to be discarded after the move anyway -- but for
  non-temporary objects, we’ve now damaged the source object. To comply with the
  <code>strong exception guarantee</code>, we’d need to move the resource back
  to the source object, but if the move failed the first time, there’s no
  guarantee the move back will succeed either.
</p>
<p>
  How can we give move constructors the <code>strong exception guarantee</code>?
  It is simple enough to avoid throwing exceptions in the body of a move
  constructor, but a move constructor may invoke other constructors that are
  <code>potentially throwing</code>. Take for example the move constructor for
  <code>std::pair</code>, which must try to move each subobject in the source
  pair into the new pair object.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token comment">// Example move constructor definition for std::pair</span>
<span class="token comment">// Take in an 'old' pair, and then move construct the new pair's 'first' and 'second' subobjects from the 'old' ones</span>
<span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword keyword-typename">typename</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span>
<span class="token class-name">pair</span><span class="token operator">&lt;</span>T1<span class="token punctuation">,</span>T2<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">pair</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-0-close">(</span>pair<span class="token operator">&amp;&amp;</span> old<span class="token punctuation brace-round brace-close brace-level-1" id="pair-0-open">)</span>
  <span class="token operator">:</span> <span class="token function">first</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-2-close">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-1-close">(</span>old<span class="token punctuation">.</span>first<span class="token punctuation brace-round brace-close brace-level-2" id="pair-1-open">)</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-2-open">)</span><span class="token punctuation">,</span>
    <span class="token function">second</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-4-close">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-3-close">(</span>old<span class="token punctuation">.</span>second<span class="token punctuation brace-round brace-close brace-level-2" id="pair-3-open">)</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-4-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-5-close">{</span><span class="token punctuation brace-curly brace-close brace-level-1" id="pair-5-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<div
  class="google-auto-placed"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: 10px auto 14px;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_11_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: visible;
      "
    >
      <iframe
        id="aswift_11"
        name="aswift_11"
        browsingtopics="true"
        style="
          left: 0;
          position: absolute;
          top: 0;
          border: 0;
          width: 1027px;
          height: 280px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="280"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2671966844&amp;adf=1629584075&amp;pi=t.aa~a.308143309~rp.1&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750431695&amp;rafmt=1&amp;to=qs&amp;pwprc=4633386603&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fstdmove_if_noexcept%2F&amp;fwr=0&amp;pra=3&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=40&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963766353&amp;bpp=1&amp;bdt=984&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C160x600%2C336x280%2C160x600%2C1027x280%2C1027x280%2C1027x280&amp;nras=5&amp;correlator=7564460993460&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=983&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C95353387%2C95362656%2C95365226%2C95365234%2C95365114%2C95359266%2C95365117%2C95365798&amp;oid=2&amp;pvsid=4708885616945287&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=12&amp;uci=a!c&amp;fsb=1&amp;dtd=14"
        data-google-container-id="a!c"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CJLrl8_trI4DFWvIFgUd5dwrQg"
      ></iframe></div
  ></ins>
</div>
<p>
  Now lets use two classes, <code>MoveClass</code> and <code>CopyClass</code>,
  which we will <code>pair</code> together to demonstrate the
  <code>strong exception guarantee</code> problem with move constructors:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;utility&gt;</span> <span class="token comment">// For std::pair, std::make_pair, std::move, std::move_if_noexcept</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// std::runtime_error</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MoveClass</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-34-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
  <span class="token keyword keyword-int">int</span><span class="token operator">*</span> m_resource<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-21-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-21-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
  <span class="token function">MoveClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-6-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-6-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>

  <span class="token function">MoveClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-7-close">(</span><span class="token keyword keyword-int">int</span> resource<span class="token punctuation brace-round brace-close brace-level-2" id="pair-7-open">)</span>
    <span class="token operator">:</span> m_resource<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-23-close">{</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation brace-curly brace-open brace-level-3" id="pair-22-close">{</span> resource <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-22-open">}</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-23-open">}</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-24-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-24-open">}</span>

  <span class="token comment">// Copy constructor</span>
  <span class="token function">MoveClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-8-close">(</span><span class="token keyword keyword-const">const</span> MoveClass<span class="token operator">&amp;</span> that<span class="token punctuation brace-round brace-close brace-level-2" id="pair-8-open">)</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-27-close">{</span>
    <span class="token comment">// deep copy</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-9-close">(</span>that<span class="token punctuation">.</span>m_resource <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-9-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-3" id="pair-26-close">{</span>
      m_resource <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-int">int</span><span class="token punctuation brace-curly brace-open brace-level-4" id="pair-25-close">{</span> <span class="token operator">*</span>that<span class="token punctuation">.</span>m_resource <span class="token punctuation brace-curly brace-close brace-level-4" id="pair-25-open">}</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-26-open">}</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-27-open">}</span>

  <span class="token comment">// Move constructor</span>
  <span class="token function">MoveClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-10-close">(</span>MoveClass<span class="token operator">&amp;&amp;</span> that<span class="token punctuation brace-round brace-close brace-level-2" id="pair-10-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token operator">:</span> m_resource<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-28-close">{</span> that<span class="token punctuation">.</span>m_resource <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-28-open">}</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-29-close">{</span>
    that<span class="token punctuation">.</span>m_resource <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-29-open">}</span>

  <span class="token operator">~</span><span class="token function">MoveClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-11-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-11-open">)</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-30-close">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"destroying "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-delete">delete</span> m_resource<span class="token punctuation">;</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-30-open">}</span>

  <span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-12-close">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> out<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> MoveClass<span class="token operator">&amp;</span> moveClass<span class="token punctuation brace-round brace-close brace-level-2" id="pair-12-open">)</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-33-close">{</span>
    out <span class="token operator">&lt;&lt;</span> <span class="token string">"MoveClass("</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-13-close">(</span>moveClass<span class="token punctuation">.</span>m_resource <span class="token operator">==</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-13-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-3" id="pair-31-close">{</span>
      out <span class="token operator">&lt;&lt;</span> <span class="token string">"empty"</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-31-open">}</span>
    <span class="token keyword keyword-else">else</span>
    <span class="token punctuation brace-curly brace-open brace-level-3" id="pair-32-close">{</span>
      out <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>moveClass<span class="token punctuation">.</span>m_resource<span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-32-open">}</span>

    out <span class="token operator">&lt;&lt;</span> <span class="token string">')'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> out<span class="token punctuation">;</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-33-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-34-open">}</span><span class="token punctuation">;</span>


<span class="token keyword keyword-class">class</span> <span class="token class-name">CopyClass</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-40-close">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
  <span class="token keyword keyword-bool">bool</span> m_throw<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-35-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-35-open">}</span><span class="token punctuation">;</span>

  <span class="token function">CopyClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-14-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-14-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>

  <span class="token comment">// Copy constructor throws an exception when copying from</span>
  <span class="token comment">// a CopyClass object where its m_throw is 'true'</span>
  <span class="token function">CopyClass</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-15-close">(</span><span class="token keyword keyword-const">const</span> CopyClass<span class="token operator">&amp;</span> that<span class="token punctuation brace-round brace-close brace-level-2" id="pair-15-open">)</span>
    <span class="token operator">:</span> m_throw<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-36-close">{</span> that<span class="token punctuation">.</span>m_throw <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-36-open">}</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-39-close">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-16-close">(</span>m_throw<span class="token punctuation brace-round brace-close brace-level-3" id="pair-16-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-3" id="pair-38-close">{</span>
      <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span>runtime_error<span class="token punctuation brace-curly brace-open brace-level-4" id="pair-37-close">{</span> <span class="token string">"abort!"</span> <span class="token punctuation brace-curly brace-close brace-level-4" id="pair-37-open">}</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-38-open">}</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-39-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-40-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-17-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-17-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-47-close">{</span>
  <span class="token comment">// We can make a std::pair without any problems:</span>
  std<span class="token double-colon punctuation">::</span>pair my_pair<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-43-close">{</span> MoveClass<span class="token punctuation brace-curly brace-open brace-level-3" id="pair-41-close">{</span> <span class="token number">13</span> <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-41-open">}</span><span class="token punctuation">,</span> CopyClass<span class="token punctuation brace-curly brace-open brace-level-3" id="pair-42-close">{</span><span class="token punctuation brace-curly brace-close brace-level-3" id="pair-42-open">}</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-43-open">}</span><span class="token punctuation">;</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"my_pair.first: "</span> <span class="token operator">&lt;&lt;</span> my_pair<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

  <span class="token comment">// But the problem arises when we try to move that pair into another pair.</span>
  <span class="token keyword keyword-try">try</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-45-close">{</span>
    my_pair<span class="token punctuation">.</span>second<span class="token punctuation">.</span>m_throw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// To trigger copy constructor exception</span>

    <span class="token comment">// The following line will throw an exception</span>
    std<span class="token double-colon punctuation">::</span>pair moved_pair<span class="token punctuation brace-curly brace-open brace-level-3" id="pair-44-close">{</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-18-close">(</span>my_pair<span class="token punctuation brace-round brace-close brace-level-4" id="pair-18-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-44-open">}</span><span class="token punctuation">;</span> <span class="token comment">// We'll comment out this line later</span>
    <span class="token comment">// std::pair moved_pair{ std::move_if_noexcept(my_pair) }; // We'll uncomment this later</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"moved pair exists\n"</span><span class="token punctuation">;</span> <span class="token comment">// Never prints</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-45-open">}</span>
  <span class="token keyword keyword-catch">catch</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-19-close">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>exception<span class="token operator">&amp;</span> ex<span class="token punctuation brace-round brace-close brace-level-2" id="pair-19-open">)</span>
  <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-46-close">{</span>
      std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Error found: "</span> <span class="token operator">&lt;&lt;</span> ex<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-20-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-20-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-46-open">}</span>

  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"my_pair.first: "</span> <span class="token operator">&lt;&lt;</span> my_pair<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-47-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>The above program prints:</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    ><div
      id="aswift_5_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_5"
        name="aswift_5"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2760828136&amp;adf=3044912414&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750431695&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fstdmove_if_noexcept%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963766288&amp;bpp=2&amp;bdt=919&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C160x600%2C336x280%2C160x600&amp;nras=2&amp;correlator=7564460993460&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=2816&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C95353387%2C95362656%2C95365226%2C95365234%2C95365114%2C95359266%2C95365117%2C95365798&amp;oid=2&amp;pvsid=4708885616945287&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=6&amp;uci=a!6&amp;btvi=1&amp;fsb=1&amp;dtd=14"
        data-google-container-id="a!6"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CKrek8_trI4DFRXIFgUdzhAlug"
      ></iframe></div
  ></ins>
</div>
<pre>
destroying MoveClass(empty)
my_pair.first: MoveClass(13)
destroying MoveClass(13)
Error found: abort!
my_pair.first: MoveClass(empty)
destroying MoveClass(empty)
</pre>
<p>
  Let’s explore what happened. The first printed line shows the temporary
  <code>MoveClass</code> object used to initialize <code>my_pair</code> gets
  destroyed as soon as the <code>my_pair</code> instantiation statement has been
  executed. It is <code>empty</code> since the <code>MoveClass</code> subobject
  in <code>my_pair</code> was move constructed from it, demonstrated by the next
  line which shows <code>my_pair.first</code> contains the
  <code>MoveClass</code> object with value <code>13</code>.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    ><div
      id="aswift_6_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_6"
        name="aswift_6"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2760828136&amp;adf=3477750738&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750431695&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fstdmove_if_noexcept%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963766288&amp;bpp=1&amp;bdt=919&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C160x600%2C336x280%2C160x600%2C1027x280&amp;nras=3&amp;correlator=7564460993460&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3345&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C95353387%2C95362656%2C95365226%2C95365234%2C95365114%2C95359266%2C95365117%2C95365798&amp;oid=2&amp;pvsid=4708885616945287&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=7&amp;uci=a!7&amp;btvi=2&amp;fsb=1&amp;dtd=15"
        data-google-container-id="a!7"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CLP7k8_trI4DFULJFgUdocE0-A"
      ></iframe></div
  ></ins>
</div>
<p>
  It gets interesting in the third line. We created <code>moved_pair</code> by
  copy constructing its <code>CopyClass</code> subobject (it doesn’t have a move
  constructor), but that copy construction threw an exception since we changed
  the Boolean flag. Construction of <code>moved_pair</code> was aborted by the
  exception, and its already-constructed members were destroyed. In this case,
  the <code>MoveClass</code> member was destroyed, printing
  <code>destroying MoveClass(13) variable</code>. Next we see the
  <code>Error found: abort!</code> message printed by <code>main()</code>.
</p>
<div class="code-block code-block-3" style="margin: 8px 0; clear: both"></div>

<p>
  When we try to print <code>my_pair.first</code> again, it shows the
  <code>MoveClass</code> member is empty. Since <code>moved_pair</code> was
  initialized with <code>std::move</code>, the <code>MoveClass</code> member
  (which has a move constructor) got move constructed and
  <code>my_pair.first</code> was nulled.
</p>
<p>Finally, <code>my_pair</code> was destroyed at the end of main().</p>
<p>
  To summarize the above results: the move constructor of
  <code>std::pair</code> used the throwing copy constructor of
  <code>CopyClass</code>. This copy constructor threw an exception, causing the
  creation of <code>moved_pair</code> to abort, and
  <code>my_pair.first</code> to be permanently damaged. The
  <code>strong exception guarantee</code> was not preserved.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    ><div
      id="aswift_7_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_7"
        name="aswift_7"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2760828136&amp;adf=2694719343&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750431695&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fstdmove_if_noexcept%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963766288&amp;bpp=1&amp;bdt=919&amp;idt=0&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C160x600%2C336x280%2C160x600%2C1027x280%2C1027x280&amp;nras=4&amp;correlator=7564460993460&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3877&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C95353387%2C95362656%2C95365226%2C95365234%2C95365114%2C95359266%2C95365117%2C95365798&amp;oid=2&amp;pvsid=4708885616945287&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=8&amp;uci=a!8&amp;btvi=3&amp;fsb=1&amp;dtd=16"
        data-google-container-id="a!8"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CKT2k8_trI4DFeDIFgUdhZETag"
      ></iframe></div
  ></ins>
</div>
<p class="cpp-section cpp-topline" style="clear: both">
  std::move_if_noexcept to the rescue
</p>
<p>
  Note that the above problem could have been avoided if
  <code>std::pair</code> had tried to do a copy instead of a move. In that case,
  <code>moved_pair</code> would have failed to construct, but
  <code>my_pair</code> would not have been altered.
</p>
<p>
  But copying instead of moving has a performance cost that we don’t want to pay
  for all objects -- ideally we want to do a move if we can do so safely, and a
  copy otherwise.
</p>
<div class="code-block code-block-4" style="margin: 8px 0; clear: both"></div>

<p>
  Fortunately, C++ has two mechanisms that, when used in combination, let us do
  exactly that. First, because <code>noexcept</code> functions are
  no-throw/no-fail, they implicitly meet the criteria for the
  <code>strong exception guarantee</code>. Thus, a <code>noexcept</code> move
  constructor is guaranteed to succeed.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    ><div
      id="aswift_8_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_8"
        name="aswift_8"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2760828136&amp;adf=1074685047&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750431695&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fstdmove_if_noexcept%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963766290&amp;bpp=1&amp;bdt=922&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C160x600%2C336x280%2C160x600%2C1027x280%2C1027x280%2C1027x280%2C1027x280&amp;nras=6&amp;correlator=7564460993460&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3829&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C95353387%2C95362656%2C95365226%2C95365234%2C95365114%2C95359266%2C95365117%2C95365798&amp;oid=2&amp;pvsid=4708885616945287&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=9&amp;uci=a!9&amp;btvi=4&amp;fsb=1&amp;dtd=265"
        data-google-container-id="a!9"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CKObo8_trI4DFTzJFgUdL-M0qw"
      ></iframe></div
  ></ins>
</div>
<p>
  Second, we can use the standard library function
  <code>std::move_if_noexcept()</code> to determine whether a move or a copy
  should be performed. <code>std::move_if_noexcept</code> is a counterpart to
  <code>std::move</code>, and is used in the same way.
</p>
<p>
  If the compiler can tell that an object passed as an argument to
  <code>std::move_if_noexcept</code> won’t throw an exception when it is move
  constructed (or if the object is move-only and has no copy constructor), then
  <code>std::move_if_noexcept</code> will perform identically to
  <code>std::move()</code> (and return the object converted to an r-value).
  Otherwise, <code>std::move_if_noexcept</code> will return a normal l-value
  reference to the object.
</p>
<div class="cpp-note cpp-lightbluebackground">
  <p class="cpp-note-title cpp-bottomline">Key insight</p>
  <p>
    <code>std::move_if_noexcept</code> will return a movable r-value if the
    object has a noexcept move constructor, otherwise it will return a copyable
    l-value. We can use the <code>noexcept</code> specifier in conjunction with
    <code>std::move_if_noexcept</code> to use move semantics only when a strong
    exception guarantee exists (and use copy semantics otherwise).
  </p>
</div>
<p>Let’s update the code in the previous example as follows:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token comment">//std::pair moved_pair{std::move(my_pair)}; // comment out this line now</span>
std<span class="token double-colon punctuation">::</span>pair moved_pair<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-49-close">{</span>std<span class="token double-colon punctuation">::</span><span class="token function">move_if_noexcept</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-48-close">(</span>my_pair<span class="token punctuation brace-round brace-close brace-level-2" id="pair-48-open">)</span><span class="token punctuation brace-curly brace-close brace-level-1" id="pair-49-open">}</span><span class="token punctuation">;</span> <span class="token comment">// and uncomment this line</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>Running the program again prints:</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_9_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<div class="code-block code-block-5" style="margin: 8px 0; clear: both"></div>

<pre>
destroying MoveClass(empty)
my_pair.first: MoveClass(13)
destroying MoveClass(13)
Error found: abort!
my_pair.first: MoveClass(13)
destroying MoveClass(13)
</pre>
<p>
  As you can see, after the exception was thrown, the subobject
  <code>my_pair.first</code> still points to the value <code>13</code>.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_10_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p>
  The move constructor of <code>std::pair</code> isn’t <code>noexcept</code> (as
  of C++20), so <code>std::move_if_noexcept</code> returns
  <code>my_pair</code> as an l-value reference. This causes
  <code>moved_pair</code> to be created via the copy constructor (rather than
  the move constructor). The copy constructor can throw safely, because it
  doesn’t modify the source object.
</p>
<p>
  The standard library uses <code>std::move_if_noexcept</code> often to optimize
  for functions that are <code>noexcept</code>. For example,
  <code>std::vector::resize</code> will use move semantics if the element type
  has a <code>noexcept</code> move constructor, and copy semantics otherwise.
  This means <code>std::vector</code> will generally operate faster with objects
  that have a <code>noexcept</code> move constructor.
</p>
<div class="cpp-note cpp-lightredbackground">
  <p class="cpp-note-title cpp-bottomline">Warning</p>
  <p>
    If a type has both potentially throwing move semantics and deleted copy
    semantics (the copy constructor and copy assignment operator are
    unavailable), then <code>std::move_if_noexcept</code> will waive the strong
    guarantee and invoke move semantics. This conditional waiving of the strong
    guarantee is ubiquitous in the standard library container classes, since
    they use std::move_if_noexcept often.
  </p>
</div>
<div class="prevnext">
  <div class="prevnext-inline">
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/chapter-27-summary-and-quiz/"
    >
      <div class="nav-button nav-button-next">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-right" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Next lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">27.x</span>Chapter 27 summary
            and quiz
          </div>
        </div>
      </div></a
    >
    <a class="nav-link" href="/">
      <div class="nav-button nav-button-index">
        <div class="nav-button-icon">
          <i class="fa fa-home" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Back to table of contents</div>
        </div>
      </div></a
    >
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/exception-specifications-and-noexcept/"
    >
      <div class="nav-button nav-button-prev">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-left" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Previous lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">27.9</span>Exception
            specifications and noexcept
          </div>
        </div>
      </div></a
    >
  </div>
</div>
<div class="code-block code-block-10" style="margin: 8px 0; clear: both"></div>

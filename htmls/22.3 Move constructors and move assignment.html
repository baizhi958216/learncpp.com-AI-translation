<div
  class="code-block code-block-1"
  style="margin: 8px 8px 8px 0; float: left"
></div>
<p>
  In lesson
  <a
    href="https://www.learncpp.com/cpp-tutorial/introduction-to-smart-pointers-move-semantics/"
    >22.1 -- Introduction to smart pointers and move semantics</a
  >, we took a look at std::auto_ptr, discussed the desire for move semantics,
  and took a look at some of the downsides that occur when functions designed
  for copy semantics (copy constructors and copy assignment operators) are
  redefined to implement move semantics.
</p>
<p>
  In this lesson, we’ll take a deeper look at how C++11 resolves these problems
  via move constructors and move assignment.
</p>
<p class="cpp-section cpp-topline" style="clear: both">
  Recapping copy constructors and copy assignment
</p>
<p>First, let’s take a moment to recap copy semantics.</p>
<p>
  Copy constructors are used to initialize a class by making a copy of an object
  of the same class. Copy assignment is used to copy one class object to another
  existing class object. By default, C++ will provide a copy constructor and
  copy assignment operator if one is not explicitly provided. These
  compiler-provided functions do shallow copies, which may cause problems for
  classes that allocate dynamic memory. So classes that deal with dynamic memory
  should override these functions to do deep copies.
</p>
<div class="code-block code-block-2" style="margin: 8px 0; clear: both"></div>

<p>
  Returning back to our Auto_ptr smart pointer class example from the first
  lesson in this chapter, let’s look at a version that implements a copy
  constructor and copy assignment operator that do deep copies, and a sample
  program that exercises them:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-template">template</span><span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Auto_ptr3</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-22-close">{</span>
	T<span class="token operator">*</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-13-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-13-open">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Auto_ptr3</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-0-close">(</span>T<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-0-open">)</span>
		<span class="token operator">:</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-14-close">{</span> ptr <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-14-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-15-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-15-open">}</span>

	<span class="token operator">~</span><span class="token function">Auto_ptr3</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-1-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-1-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-16-close">{</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-16-open">}</span>

	<span class="token comment">// Copy constructor</span>
	<span class="token comment">// Do deep copy of a.m_ptr to m_ptr</span>
	<span class="token function">Auto_ptr3</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-2-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr3<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-2-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-17-close">{</span>
		m_ptr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation">;</span>
		<span class="token operator">*</span>m_ptr <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-17-open">}</span>

	<span class="token comment">// Copy assignment</span>
	<span class="token comment">// Do deep copy of a.m_ptr to m_ptr</span>
	Auto_ptr3<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-3-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr3<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-3-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-18-close">{</span>
		<span class="token comment">// Self-assignment detection</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-4-close">(</span><span class="token operator">&amp;</span>a <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-4-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token comment">// Release any resource we're holding</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>

		<span class="token comment">// Copy the resource</span>
		m_ptr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation">;</span>
		<span class="token operator">*</span>m_ptr <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-18-open">}</span>

	T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-5-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-5-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-19-close">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">*</span>m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-19-open">}</span>
	T<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-6-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-6-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-20-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-20-open">}</span>
	<span class="token keyword keyword-bool">bool</span> <span class="token function">isNull</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-7-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-7-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-21-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr <span class="token operator">==</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-21-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-22-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Resource</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-25-close">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Resource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-8-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-8-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-23-close">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Resource acquired\n"</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-23-open">}</span>
	<span class="token operator">~</span><span class="token function">Resource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-9-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-9-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-24-close">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Resource destroyed\n"</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-24-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-25-open">}</span><span class="token punctuation">;</span>

Auto_ptr3<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> <span class="token function">generateResource</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-10-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-10-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-27-close">{</span>
	Auto_ptr3<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> res<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-26-close">{</span><span class="token keyword keyword-new">new</span> Resource<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-26-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span> <span class="token comment">// this return value will invoke the copy constructor</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-27-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-11-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-11-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-28-close">{</span>
	Auto_ptr3<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> mainres<span class="token punctuation">;</span>
	mainres <span class="token operator">=</span> <span class="token function">generateResource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-12-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-12-open">)</span><span class="token punctuation">;</span> <span class="token comment">// this assignment will invoke the copy assignment</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-28-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_5_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_5"
        name="aswift_5"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1075880535&amp;adf=327191521&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750405282&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fmove-constructors-and-move-assignment%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963386457&amp;bpp=1&amp;bdt=951&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600&amp;nras=2&amp;correlator=2735870930224&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=1870&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C95353386%2C95362656%2C95364946%2C95365226%2C95365234%2C42533293%2C95365114%2C95359265%2C95365121%2C95365798&amp;oid=2&amp;pvsid=1642585792563304&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=6&amp;uci=a!6&amp;btvi=1&amp;fsb=1&amp;dtd=38"
        data-google-container-id="a!6"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CKe5hprsrI4DFT5EwgUd8co56g"
      ></iframe></div
  ></ins>
</div>
<p>
  In this program, we’re using a function named generateResource() to create a
  smart pointer encapsulated resource, which is then passed back to function
  main(). Function main() then assigns that to an existing Auto_ptr3 object.
</p>
<p>When this program is run, it prints:</p>
<pre>
Resource acquired
Resource acquired
Resource destroyed
Resource acquired
Resource destroyed
Resource destroyed
</pre>
<p>
  (Note: You may only get 4 outputs if your compiler elides the return value
  from function generateResource())
</p>
<p>
  That’s a lot of resource creation and destruction going on for such a simple
  program! What’s going on here?
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_6_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_6"
        name="aswift_6"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1075880535&amp;adf=52336061&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750405282&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fmove-constructors-and-move-assignment%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963386457&amp;bpp=1&amp;bdt=951&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280&amp;nras=3&amp;correlator=2735870930224&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=2479&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C95353386%2C95362656%2C95364946%2C95365226%2C95365234%2C42533293%2C95365114%2C95359265%2C95365121%2C95365798&amp;oid=2&amp;pvsid=1642585792563304&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=7&amp;uci=a!7&amp;btvi=2&amp;fsb=1&amp;dtd=43"
        data-google-container-id="a!7"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CMTMhprsrI4DFUFZwgUddbQrsg"
      ></iframe></div
  ></ins>
</div>
<div class="code-block code-block-3" style="margin: 8px 0; clear: both"></div>

<p>
  Let’s take a closer look. There are 6 key steps that happen in this program
  (one for each printed message):
</p>
<ol start="1">
  <li>
    Inside generateResource(), local variable res is created and initialized
    with a dynamically allocated Resource, which causes the first “Resource
    acquired”.
  </li>
  <li>
    Res is returned back to main() by value. We return by value here because res
    is a local variable -- it can’t be returned by address or reference because
    res will be destroyed when generateResource() ends. So res is copy
    constructed into a temporary object. Since our copy constructor does a deep
    copy, a new Resource is allocated here, which causes the second “Resource
    acquired”.
  </li>
  <li>
    Res goes out of scope, destroying the originally created Resource, which
    causes the first “Resource destroyed”.
  </li>
  <li>
    The temporary object is assigned to mainres by copy assignment. Since our
    copy assignment also does a deep copy, a new Resource is allocated, causing
    yet another “Resource acquired”.
  </li>
  <li>
    The assignment expression ends, and the temporary object goes out of
    expression scope and is destroyed, causing a “Resource destroyed”.
  </li>
  <li>
    At the end of main(), mainres goes out of scope, and our final “Resource
    destroyed” is displayed.
  </li>
</ol>
<p>
  So, in short, because we call the copy constructor once to copy construct res
  to a temporary, and copy assignment once to copy the temporary into mainres,
  we end up allocating and destroying 3 separate objects in total.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_7_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_7"
        name="aswift_7"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1075880535&amp;adf=3584275989&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750405282&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fmove-constructors-and-move-assignment%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963386457&amp;bpp=1&amp;bdt=951&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280&amp;nras=4&amp;correlator=2735870930224&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3062&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C95353386%2C95362656%2C95364946%2C95365226%2C95365234%2C42533293%2C95365114%2C95359265%2C95365121%2C95365798&amp;oid=2&amp;pvsid=1642585792563304&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=8&amp;uci=a!8&amp;btvi=3&amp;fsb=1&amp;dtd=44"
        data-google-container-id="a!8"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CMLthprsrI4DFddOwgUdpowRtA"
      ></iframe></div
  ></ins>
</div>
<p>Inefficient, but at least it doesn’t crash!</p>
<p>However, with move semantics, we can do better.</p>
<p class="cpp-section cpp-topline" style="clear: both">
  Move constructors and move assignment
</p>
<div class="code-block code-block-4" style="margin: 8px 0; clear: both"></div>

<p>
  C++11 defines two new functions in service of move semantics: a move
  constructor, and a move assignment operator. Whereas the goal of the copy
  constructor and copy assignment is to make a copy of one object to another,
  the goal of the move constructor and move assignment is to move ownership of
  the resources from one object to another (which is typically much less
  expensive than making a copy).
</p>
<p>
  Defining a move constructor and move assignment work analogously to their copy
  counterparts. However, whereas the copy flavors of these functions take a
  const l-value reference parameter (which will bind to just about anything),
  the move flavors of these functions use non-const rvalue reference parameters
  (which only bind to rvalues).
</p>
<p>
  Here’s the same Auto_ptr3 class as above, with a move constructor and move
  assignment operator added. We’ve left in the deep-copying copy constructor and
  copy assignment operator for comparison purposes.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_8_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_8"
        name="aswift_8"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1075880535&amp;adf=3532491732&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750405282&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fmove-constructors-and-move-assignment%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963386457&amp;bpp=1&amp;bdt=950&amp;idt=0&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280%2C1027x280&amp;nras=5&amp;correlator=2735870930224&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3668&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C95353386%2C95362656%2C95364946%2C95365226%2C95365234%2C42533293%2C95365114%2C95359265%2C95365121%2C95365798&amp;oid=2&amp;pvsid=1642585792563304&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=9&amp;uci=a!9&amp;btvi=4&amp;fsb=1&amp;dtd=45"
        data-google-container-id="a!9"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="COTwhprsrI4DFbZEwgUdFaUO0Q"
      ></iframe></div
  ></ins>
</div>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-template">template</span><span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Auto_ptr4</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-57-close">{</span>
	T<span class="token operator">*</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-45-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-45-open">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Auto_ptr4</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-29-close">(</span>T<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-29-open">)</span>
		<span class="token operator">:</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-46-close">{</span> ptr <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-46-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-47-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-47-open">}</span>

	<span class="token operator">~</span><span class="token function">Auto_ptr4</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-30-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-30-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-48-close">{</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-48-open">}</span>

	<span class="token comment">// Copy constructor</span>
	<span class="token comment">// Do deep copy of a.m_ptr to m_ptr</span>
	<span class="token function">Auto_ptr4</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-31-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr4<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-31-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-49-close">{</span>
		m_ptr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation">;</span>
		<span class="token operator">*</span>m_ptr <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-49-open">}</span>

	<span class="token comment">// Move constructor</span>
	<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
	<span class="token function">Auto_ptr4</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-32-close">(</span>Auto_ptr4<span class="token operator">&amp;&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-32-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
		<span class="token operator">:</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-50-close">{</span> a<span class="token punctuation">.</span>m_ptr <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-50-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-51-close">{</span>
		a<span class="token punctuation">.</span>m_ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token comment">// we'll talk more about this line below</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-51-open">}</span>

	<span class="token comment">// Copy assignment</span>
	<span class="token comment">// Do deep copy of a.m_ptr to m_ptr</span>
	Auto_ptr4<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-33-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr4<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-33-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-52-close">{</span>
		<span class="token comment">// Self-assignment detection</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-34-close">(</span><span class="token operator">&amp;</span>a <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-34-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token comment">// Release any resource we're holding</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>

		<span class="token comment">// Copy the resource</span>
		m_ptr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation">;</span>
		<span class="token operator">*</span>m_ptr <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-52-open">}</span>

	<span class="token comment">// Move assignment</span>
	<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
	Auto_ptr4<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-35-close">(</span>Auto_ptr4<span class="token operator">&amp;&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-35-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-53-close">{</span>
		<span class="token comment">// Self-assignment detection</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-36-close">(</span><span class="token operator">&amp;</span>a <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-36-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token comment">// Release any resource we're holding</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>

		<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
		m_ptr <span class="token operator">=</span> a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>
		a<span class="token punctuation">.</span>m_ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token comment">// we'll talk more about this line below</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-53-open">}</span>

	T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-37-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-37-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-54-close">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">*</span>m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-54-open">}</span>
	T<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-38-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-38-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-55-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-55-open">}</span>
	<span class="token keyword keyword-bool">bool</span> <span class="token function">isNull</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-39-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-39-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-56-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr <span class="token operator">==</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-56-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-57-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Resource</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-60-close">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Resource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-40-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-40-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-58-close">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Resource acquired\n"</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-58-open">}</span>
	<span class="token operator">~</span><span class="token function">Resource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-41-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-41-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-59-close">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Resource destroyed\n"</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-59-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-60-open">}</span><span class="token punctuation">;</span>

Auto_ptr4<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> <span class="token function">generateResource</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-42-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-42-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-62-close">{</span>
	Auto_ptr4<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> res<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-61-close">{</span><span class="token keyword keyword-new">new</span> Resource<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-61-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span> <span class="token comment">// this return value will invoke the move constructor</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-62-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-43-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-43-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-63-close">{</span>
	Auto_ptr4<span class="token operator">&lt;</span>Resource<span class="token operator">&gt;</span> mainres<span class="token punctuation">;</span>
	mainres <span class="token operator">=</span> <span class="token function">generateResource</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-44-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-44-open">)</span><span class="token punctuation">;</span> <span class="token comment">// this assignment will invoke the move assignment</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-63-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_9_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p>
  The move constructor and move assignment operator are simple. Instead of deep
  copying the source object (<code>a</code>) into the destination object (the
  implicit object), we simply move (steal) the source object’s resources. This
  involves shallow copying the source pointer into the implicit object, then
  setting the source pointer to null.
</p>
<p>When run, this program prints:</p>
<div class="code-block code-block-5" style="margin: 8px 0; clear: both"></div>

<pre>
Resource acquired
Resource destroyed
</pre>
<p>That’s much better!</p>
<p>
  The flow of the program is exactly the same as before. However, instead of
  calling the copy constructor and copy assignment operators, this program calls
  the move constructor and move assignment operators. Looking a little more
  deeply:
</p>
<ol start="1">
  <li>
    Inside generateResource(), local variable res is created and initialized
    with a dynamically allocated Resource, which causes the first “Resource
    acquired”.
  </li>
  <li>
    Res is returned back to main() by value. Res is move constructed into a
    temporary object, transferring the dynamically created object stored in res
    to the temporary object. We’ll talk about why this happens below.
  </li>
  <li>
    Res goes out of scope. Because res no longer manages a pointer (it was moved
    to the temporary), nothing interesting happens here.
  </li>
  <li>
    The temporary object is move assigned to mainres. This transfers the
    dynamically created object stored in the temporary to mainres.
  </li>
  <li>
    The assignment expression ends, and the temporary object goes out of
    expression scope and is destroyed. However, because the temporary no longer
    manages a pointer (it was moved to mainres), nothing interesting happens
    here either.
  </li>
  <li>
    At the end of main(), mainres goes out of scope, and our final “Resource
    destroyed” is displayed.
  </li>
</ol>
<p>
  So instead of copying our Resource twice (once for the copy constructor and
  once for the copy assignment), we transfer it twice. This is more efficient,
  as Resource is only constructed and destroyed once instead of three times.
</p>
<div class="cpp-note cpp-lightgraybackground">
  <p class="cpp-note-title cpp-bottomline">Related content</p>
  <p>
    Move constructors and move assignment should be marked as
    <code>noexcept</code>. This tells the compiler that these functions will not
    throw exceptions.
  </p>
  <p>
    We introduce <code>noexcept</code> in lesson
    <a
      href="https://www.learncpp.com/cpp-tutorial/exception-specifications-and-noexcept/"
      >27.9 -- Exception specifications and noexcept</a
    >
    and discuss why move constructors and move assignment are marked as
    <code>noexcept</code> in lesson
    <a href="https://www.learncpp.com/cpp-tutorial/stdmove_if_noexcept/"
      >27.10 -- std::move_if_noexcept</a
    >.
  </p>
</div>
<p class="cpp-section cpp-topline" style="clear: both">
  When are the move constructor and move assignment called?
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_10_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p>
  The move constructor and move assignment are called when those functions have
  been defined, and the argument for construction or assignment is an rvalue.
  Most typically, this rvalue will be a literal or temporary value.
</p>
<p>
  The copy constructor and copy assignment are used otherwise (when the argument
  is an lvalue, or when the argument is an rvalue and the move constructor or
  move assignment functions aren’t defined).
</p>
<div class="code-block code-block-6" style="margin: 8px 0; clear: both"></div>

<p class="cpp-section cpp-topline" style="clear: both">
  Implicit move constructor and move assignment operator
</p>
<p>
  The compiler will create an implicit move constructor and move assignment
  operator if all of the following are true:
</p>
<ul>
  <li>
    There are no user-declared copy constructors or copy assignment operators.
  </li>
  <li>
    There are no user-declared move constructors or move assignment operators.
  </li>
  <li>There is no user-declared destructor.</li>
</ul>
<p>These functions do a memberwise move, which behaves as follows:</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_11_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<ul>
  <li>
    If member has a move constructor or move assignment (as appropriate), it
    will be invoked.
  </li>
  <li>Otherwise, the member will be copied.</li>
</ul>
<p>Notably, this means that pointers will be copied, not moved!</p>
<div class="cpp-note cpp-lightredbackground">
  <p class="cpp-note-title cpp-bottomline">Warning</p>
  <p>
    The implicit move constructor and move assignment will copy pointers, not
    move them. If you want to move a pointer member, you will need to define the
    move constructor and move assignment yourself.
  </p>
</div>
<p class="cpp-section cpp-topline" style="clear: both">
  The key insight behind move semantics
</p>
<div class="code-block code-block-7" style="margin: 8px 0; clear: both"></div>

<p>
  You now have enough context to understand the key insight behind move
  semantics.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_12_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p>
  If we construct an object or do an assignment where the argument is an
  l-value, the only thing we can reasonably do is copy the l-value. We can’t
  assume it’s safe to alter the l-value, because it may be used again later in
  the program. If we have an expression “a = b” (where b is an lvalue), we
  wouldn’t reasonably expect b to be changed in any way.
</p>
<p>
  However, if we construct an object or do an assignment where the argument is
  an r-value, then we know that r-value is just a temporary object of some kind.
  Instead of copying it (which can be expensive), we can simply transfer its
  resources (which is cheap) to the object we’re constructing or assigning. This
  is safe to do because the temporary will be destroyed at the end of the
  expression anyway, so we know it will never be used again!
</p>
<p>
  C++11, through r-value references, gives us the ability to provide different
  behaviors when the argument is an r-value vs an l-value, enabling us to make
  smarter and more efficient decisions about how our objects should behave.
</p>
<div class="cpp-note cpp-lightbluebackground">
  <p class="cpp-note-title cpp-bottomline">Key insight</p>
  <p>Move semantics is an optimization opportunity.</p>
</div>
<p class="cpp-section cpp-topline" style="clear: both">
  Move functions should always leave both objects in a valid state
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_13_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<div class="code-block code-block-8" style="margin: 8px 0; clear: both"></div>

<p>
  In the above examples, both the move constructor and move assignment functions
  set a.m_ptr to nullptr. This may seem extraneous -- after all, if
  <code>a</code> is a temporary r-value, why bother doing “cleanup” if parameter
  <code>a</code> is going to be destroyed anyway?
</p>
<p>
  The answer is simple: When <code>a</code> goes out of scope, the destructor
  for <code>a</code> will be called, and <code>a.m_ptr</code> will be deleted.
  If at that point, <code>a.m_ptr</code> is still pointing to the same object as
  <code>m_ptr</code>, then <code>m_ptr</code> will be left as a dangling
  pointer. When the object containing <code>m_ptr</code> eventually gets used
  (or destroyed), we’ll get undefined behavior.
</p>
<p>
  When implementing move semantics, it is important to ensure the moved-from
  object is left in a valid state, so that it will destruct properly (without
  creating undefined behavior).
</p>
<p class="cpp-section cpp-topline" style="clear: both">
  Automatic l-values returned by value may be moved instead of copied
</p>
<p>
  In the generateResource() function of the Auto_ptr4 example above, when
  variable res is returned by value, it is moved instead of copied, even though
  res is an l-value. The C++ specification has a special rule that says
  automatic objects returned from a function by value can be moved even if they
  are l-values. This makes sense, since res was going to be destroyed at the end
  of the function anyway! We might as well steal its resources instead of making
  an expensive and unnecessary copy.
</p>
<p>
  Although the compiler can move l-value return values, in some cases it may be
  able to do even better by simply eliding the copy altogether (which avoids the
  need to make a copy or do a move at all). In such a case, neither the copy
  constructor nor move constructor would be called.
</p>
<p class="cpp-section cpp-topline" style="clear: both">Disabling copying</p>
<p>
  In the Auto_ptr4 class above, we left in the copy constructor and assignment
  operator for comparison purposes. But in move-enabled classes, it is sometimes
  desirable to delete the copy constructor and copy assignment functions to
  ensure copies aren’t made. In the case of our Auto_ptr class, we don’t want to
  copy our templated object T -- both because it’s expensive, and whatever class
  T is may not even support copying!
</p>
<p>
  Here’s a version of Auto_ptr that supports move semantics but not copy
  semantics:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-template">template</span><span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Auto_ptr5</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-84-close">{</span>
	T<span class="token operator">*</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-74-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-74-open">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Auto_ptr5</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-64-close">(</span>T<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-64-open">)</span>
		<span class="token operator">:</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-75-close">{</span> ptr <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-75-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-76-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-76-open">}</span>

	<span class="token operator">~</span><span class="token function">Auto_ptr5</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-65-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-65-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-77-close">{</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-77-open">}</span>

	<span class="token comment">// Copy constructor -- no copying allowed!</span>
	<span class="token function">Auto_ptr5</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-66-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr5<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-66-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

	<span class="token comment">// Move constructor</span>
	<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
	<span class="token function">Auto_ptr5</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-67-close">(</span>Auto_ptr5<span class="token operator">&amp;&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-67-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
		<span class="token operator">:</span> m_ptr <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-78-close">{</span> a<span class="token punctuation">.</span>m_ptr <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-78-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-79-close">{</span>
		a<span class="token punctuation">.</span>m_ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-79-open">}</span>

	<span class="token comment">// Copy assignment -- no copying allowed!</span>
	Auto_ptr5<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-68-close">(</span><span class="token keyword keyword-const">const</span> Auto_ptr5<span class="token operator">&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-68-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

	<span class="token comment">// Move assignment</span>
	<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
	Auto_ptr5<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-69-close">(</span>Auto_ptr5<span class="token operator">&amp;&amp;</span> a<span class="token punctuation brace-round brace-close brace-level-2" id="pair-69-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-80-close">{</span>
		<span class="token comment">// Self-assignment detection</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-70-close">(</span><span class="token operator">&amp;</span>a <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-70-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token comment">// Release any resource we're holding</span>
		<span class="token keyword keyword-delete">delete</span> m_ptr<span class="token punctuation">;</span>

		<span class="token comment">// Transfer ownership of a.m_ptr to m_ptr</span>
		m_ptr <span class="token operator">=</span> a<span class="token punctuation">.</span>m_ptr<span class="token punctuation">;</span>
		a<span class="token punctuation">.</span>m_ptr <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-80-open">}</span>

	T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-71-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-71-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-81-close">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">*</span>m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-81-open">}</span>
	T<span class="token operator">*</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">-&gt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-72-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-72-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-82-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-82-open">}</span>
	<span class="token keyword keyword-bool">bool</span> <span class="token function">isNull</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-73-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-73-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-83-close">{</span> <span class="token keyword keyword-return">return</span> m_ptr <span class="token operator">==</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-83-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-84-open">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  If you were to try to pass an Auto_ptr5 l-value to a function by value, the
  compiler would complain that the copy constructor required to initialize the
  function parameter has been deleted. This is good, because we should probably
  be passing Auto_ptr5 by const l-value reference anyway!
</p>
<p>
  Auto_ptr5 is (finally) a good smart pointer class. And, in fact the standard
  library contains a class very much like this one (that you should use
  instead), named std::unique_ptr. We’ll talk more about std::unique_ptr later
  in this chapter.
</p>
<p class="cpp-section cpp-topline" style="clear: both">Another example</p>
<p>
  Let’s take a look at another class that uses dynamic memory: a simple dynamic
  templated array. This class contains a deep-copying copy constructor and copy
  assignment operator.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstddef&gt;</span> <span class="token comment">// for std::size_t</span></span>

<span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">DynamicArray</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-117-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	T<span class="token operator">*</span> m_array <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-107-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-107-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> m_length <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-108-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-108-open">}</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-void">void</span> <span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-85-close">(</span><span class="token keyword keyword-int">int</span> length<span class="token punctuation brace-round brace-close brace-level-2" id="pair-85-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-109-close">{</span>
		m_array <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation brace-square brace-open brace-level-3" id="pair-100-close">[</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>size_t<span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-86-close">(</span>length<span class="token punctuation brace-round brace-close brace-level-4" id="pair-86-open">)</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-100-open">]</span><span class="token punctuation">;</span>
        	m_length <span class="token operator">=</span> length<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-109-open">}</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-87-close">(</span><span class="token keyword keyword-int">int</span> length<span class="token punctuation brace-round brace-close brace-level-2" id="pair-87-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-110-close">{</span>
		<span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-88-close">(</span>length<span class="token punctuation brace-round brace-close brace-level-3" id="pair-88-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-110-open">}</span>

	<span class="token operator">~</span><span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-89-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-89-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-111-close">{</span>
		<span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-101-close">[</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-101-open">]</span> m_array<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-111-open">}</span>

	<span class="token comment">// Copy constructor</span>
	<span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-90-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-90-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-112-close">{</span>
		<span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-91-close">(</span>arr<span class="token punctuation">.</span>m_length<span class="token punctuation brace-round brace-close brace-level-3" id="pair-91-open">)</span><span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span><span class="token function">copy_n</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-92-close">(</span>arr<span class="token punctuation">.</span>m_array<span class="token punctuation">,</span> m_length<span class="token punctuation">,</span> m_array<span class="token punctuation brace-round brace-close brace-level-3" id="pair-92-open">)</span><span class="token punctuation">;</span> <span class="token comment">// copy m_length elements from arr to m_array</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-112-open">}</span>

	<span class="token comment">// Copy assignment</span>
	DynamicArray<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-93-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-93-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-113-close">{</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-94-close">(</span><span class="token operator">&amp;</span>arr <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-94-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-102-close">[</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-102-open">]</span> m_array<span class="token punctuation">;</span>

		<span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-95-close">(</span>arr<span class="token punctuation">.</span>m_length<span class="token punctuation brace-round brace-close brace-level-3" id="pair-95-open">)</span><span class="token punctuation">;</span>

		std<span class="token double-colon punctuation">::</span><span class="token function">copy_n</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-96-close">(</span>arr<span class="token punctuation">.</span>m_array<span class="token punctuation">,</span> m_length<span class="token punctuation">,</span> m_array<span class="token punctuation brace-round brace-close brace-level-3" id="pair-96-open">)</span><span class="token punctuation">;</span> <span class="token comment">// copy m_length elements from arr to m_array</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-113-open">}</span>

	<span class="token keyword keyword-int">int</span> <span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-97-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-97-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-114-close">{</span> <span class="token keyword keyword-return">return</span> m_length<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-114-open">}</span>
	T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation brace-square brace-open brace-level-2" id="pair-103-close">[</span><span class="token punctuation brace-square brace-close brace-level-2" id="pair-103-open">]</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-98-close">(</span><span class="token keyword keyword-int">int</span> index<span class="token punctuation brace-round brace-close brace-level-2" id="pair-98-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-115-close">{</span> <span class="token keyword keyword-return">return</span> m_array<span class="token punctuation brace-square brace-open brace-level-3" id="pair-104-close">[</span>index<span class="token punctuation brace-square brace-close brace-level-3" id="pair-104-open">]</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-115-open">}</span>
	<span class="token keyword keyword-const">const</span> T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation brace-square brace-open brace-level-2" id="pair-105-close">[</span><span class="token punctuation brace-square brace-close brace-level-2" id="pair-105-open">]</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-99-close">(</span><span class="token keyword keyword-int">int</span> index<span class="token punctuation brace-round brace-close brace-level-2" id="pair-99-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-116-close">{</span> <span class="token keyword keyword-return">return</span> m_array<span class="token punctuation brace-square brace-open brace-level-3" id="pair-106-close">[</span>index<span class="token punctuation brace-square brace-close brace-level-3" id="pair-106-open">]</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-116-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-117-open">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Now let’s use this class in a program. To show you how this class performs
  when we allocate a million integers on the heap, we’re going to leverage the
  Timer class we developed in lesson
  <a href="https://www.learncpp.com/cpp-tutorial/timing-your-code/"
    >18.4 -- Timing your code</a
  >. We’ll use the Timer class to time how fast our code runs, and show you the
  performance difference between copying and moving.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span> <span class="token comment">// for std::copy_n</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span> <span class="token comment">// for std::chrono functions</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token comment">// Uses the above DynamicArray class</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Timer</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-142-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token comment">// Type aliases to make accessing nested type easier</span>
	<span class="token keyword keyword-using">using</span> Clock <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>high_resolution_clock<span class="token punctuation">;</span>
	<span class="token keyword keyword-using">using</span> Second <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>duration<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ratio<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>time_point<span class="token operator">&lt;</span>Clock<span class="token operator">&gt;</span> m_beg <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-139-close">{</span> <span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-118-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-118-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-139-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">reset</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-119-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-119-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-140-close">{</span>
		m_beg <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-120-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-120-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-140-open">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">elapsed</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-121-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-121-open">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-141-close">{</span>
		<span class="token keyword keyword-return">return</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">duration_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Second<span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-123-close">(</span><span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-122-close">(</span><span class="token punctuation brace-round brace-close brace-level-4" id="pair-122-open">)</span> <span class="token operator">-</span> m_beg<span class="token punctuation brace-round brace-close brace-level-3" id="pair-123-open">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-124-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-124-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-141-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-142-open">}</span><span class="token punctuation">;</span>

<span class="token comment">// Return a copy of arr with all of the values doubled</span>
DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">cloneArrayAndDouble</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-125-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-1" id="pair-125-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-143-close">{</span>
	DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">dbl</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-127-close">(</span>arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-126-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-126-open">)</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-127-open">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-129-close">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-128-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-128-open">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation brace-round brace-close brace-level-2" id="pair-129-open">)</span>
		dbl<span class="token punctuation brace-square brace-open brace-level-2" id="pair-136-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-136-open">]</span> <span class="token operator">=</span> arr<span class="token punctuation brace-square brace-open brace-level-2" id="pair-137-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-137-open">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> dbl<span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-143-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-130-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-130-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-144-close">{</span>
	Timer t<span class="token punctuation">;</span>

	DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">arr</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-131-close">(</span><span class="token number">1000000</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-131-open">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-133-close">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-132-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-132-open">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-133-open">)</span>
		arr<span class="token punctuation brace-square brace-open brace-level-2" id="pair-138-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-138-open">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>

	arr <span class="token operator">=</span> <span class="token function">cloneArrayAndDouble</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-134-close">(</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-134-open">)</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-135-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-135-open">)</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-144-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  On one of the author’s machines, in release mode, this program executed in
  0.00825559 seconds.
</p>
<p>
  Now let’s update <code>DynamicArray</code> by replacing the copy constructor
  and copy assignment with a move constructor and move assignment, and then run
  the program again:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstddef&gt;</span> <span class="token comment">// for std::size_t</span></span>

<span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">DynamicArray</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-198-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	T<span class="token operator">*</span> m_array <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-186-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-186-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> m_length <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-187-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-187-open">}</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-void">void</span> <span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-145-close">(</span><span class="token keyword keyword-int">int</span> length<span class="token punctuation brace-round brace-close brace-level-2" id="pair-145-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-188-close">{</span>
		m_array <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> T<span class="token punctuation brace-square brace-open brace-level-3" id="pair-176-close">[</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>size_t<span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-146-close">(</span>length<span class="token punctuation brace-round brace-close brace-level-4" id="pair-146-open">)</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-176-open">]</span><span class="token punctuation">;</span>
		m_length <span class="token operator">=</span> length<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-188-open">}</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-147-close">(</span><span class="token keyword keyword-int">int</span> length<span class="token punctuation brace-round brace-close brace-level-2" id="pair-147-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-189-close">{</span>
		<span class="token function">alloc</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-148-close">(</span>length<span class="token punctuation brace-round brace-close brace-level-3" id="pair-148-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-189-open">}</span>

	<span class="token operator">~</span><span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-149-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-149-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-190-close">{</span>
		<span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-177-close">[</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-177-open">]</span> m_array<span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-190-open">}</span>

	<span class="token comment">// Copy constructor</span>
	<span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-150-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-150-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

	<span class="token comment">// Copy assignment</span>
	DynamicArray<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-151-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-151-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

	<span class="token comment">// Move constructor</span>
	<span class="token function">DynamicArray</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-152-close">(</span>DynamicArray <span class="token operator">&amp;&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-152-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
		<span class="token operator">:</span>  m_array <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-191-close">{</span> arr<span class="token punctuation">.</span>m_array <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-191-open">}</span><span class="token punctuation">,</span> m_length <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-192-close">{</span> arr<span class="token punctuation">.</span>m_length <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-192-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-193-close">{</span>
		arr<span class="token punctuation">.</span>m_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		arr<span class="token punctuation">.</span>m_array <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-193-open">}</span>

	<span class="token comment">// Move assignment</span>
	DynamicArray<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-153-close">(</span>DynamicArray <span class="token operator">&amp;&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-153-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-194-close">{</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-154-close">(</span><span class="token operator">&amp;</span>arr <span class="token operator">==</span> <span class="token keyword keyword-this">this</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-154-open">)</span>
			<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

		<span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-178-close">[</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-178-open">]</span> m_array<span class="token punctuation">;</span>

		m_length <span class="token operator">=</span> arr<span class="token punctuation">.</span>m_length<span class="token punctuation">;</span>
		m_array <span class="token operator">=</span> arr<span class="token punctuation">.</span>m_array<span class="token punctuation">;</span>
		arr<span class="token punctuation">.</span>m_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		arr<span class="token punctuation">.</span>m_array <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>

		<span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-194-open">}</span>

	<span class="token keyword keyword-int">int</span> <span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-155-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-155-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-195-close">{</span> <span class="token keyword keyword-return">return</span> m_length<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-195-open">}</span>
	T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation brace-square brace-open brace-level-2" id="pair-179-close">[</span><span class="token punctuation brace-square brace-close brace-level-2" id="pair-179-open">]</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-156-close">(</span><span class="token keyword keyword-int">int</span> index<span class="token punctuation brace-round brace-close brace-level-2" id="pair-156-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-196-close">{</span> <span class="token keyword keyword-return">return</span> m_array<span class="token punctuation brace-square brace-open brace-level-3" id="pair-180-close">[</span>index<span class="token punctuation brace-square brace-close brace-level-3" id="pair-180-open">]</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-196-open">}</span>
	<span class="token keyword keyword-const">const</span> T<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation brace-square brace-open brace-level-2" id="pair-181-close">[</span><span class="token punctuation brace-square brace-close brace-level-2" id="pair-181-open">]</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-157-close">(</span><span class="token keyword keyword-int">int</span> index<span class="token punctuation brace-round brace-close brace-level-2" id="pair-157-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-197-close">{</span> <span class="token keyword keyword-return">return</span> m_array<span class="token punctuation brace-square brace-open brace-level-3" id="pair-182-close">[</span>index<span class="token punctuation brace-square brace-close brace-level-3" id="pair-182-open">]</span><span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-197-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-198-open">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span> <span class="token comment">// for std::chrono functions</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Timer</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-202-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
	<span class="token comment">// Type aliases to make accessing nested type easier</span>
	<span class="token keyword keyword-using">using</span> Clock <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>high_resolution_clock<span class="token punctuation">;</span>
	<span class="token keyword keyword-using">using</span> Second <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>duration<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ratio<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>time_point<span class="token operator">&lt;</span>Clock<span class="token operator">&gt;</span> m_beg <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-199-close">{</span> <span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-158-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-158-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-199-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token keyword keyword-void">void</span> <span class="token function">reset</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-159-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-159-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-200-close">{</span>
		m_beg <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-160-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-160-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-200-open">}</span>

	<span class="token keyword keyword-double">double</span> <span class="token function">elapsed</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-161-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-161-open">)</span> <span class="token keyword keyword-const">const</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-201-close">{</span>
		<span class="token keyword keyword-return">return</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">duration_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Second<span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-163-close">(</span><span class="token class-name">Clock</span><span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-162-close">(</span><span class="token punctuation brace-round brace-close brace-level-4" id="pair-162-open">)</span> <span class="token operator">-</span> m_beg<span class="token punctuation brace-round brace-close brace-level-3" id="pair-163-open">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-164-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-164-open">)</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-201-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-202-open">}</span><span class="token punctuation">;</span>

<span class="token comment">// Return a copy of arr with all of the values doubled</span>
DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">cloneArrayAndDouble</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-165-close">(</span><span class="token keyword keyword-const">const</span> DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>arr<span class="token punctuation brace-round brace-close brace-level-1" id="pair-165-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-203-close">{</span>
	DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">dbl</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-167-close">(</span>arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-166-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-166-open">)</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-167-open">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-169-close">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-168-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-168-open">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation brace-round brace-close brace-level-2" id="pair-169-open">)</span>
		dbl<span class="token punctuation brace-square brace-open brace-level-2" id="pair-183-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-183-open">]</span> <span class="token operator">=</span> arr<span class="token punctuation brace-square brace-open brace-level-2" id="pair-184-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-184-open">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> dbl<span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-203-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-170-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-170-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-204-close">{</span>
	Timer t<span class="token punctuation">;</span>

	DynamicArray<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">arr</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-171-close">(</span><span class="token number">1000000</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-171-open">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-173-close">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-172-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-172-open">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-173-open">)</span>
		arr<span class="token punctuation brace-square brace-open brace-level-2" id="pair-185-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-2" id="pair-185-open">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>

	arr <span class="token operator">=</span> <span class="token function">cloneArrayAndDouble</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-174-close">(</span>arr<span class="token punctuation brace-round brace-close brace-level-2" id="pair-174-open">)</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-175-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-175-open">)</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-204-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>On the same machine, this program executed in 0.0056 seconds.</p>
<p>
  Comparing the runtime of the two programs, (0.00825559 - 0.0056) / 0.00825559
  * 100 = 32.1% faster!
</p>
<p class="cpp-section cpp-topline" style="clear: both">
  Deleting the move constructor and move assignment
</p>
<p>
  You can delete the move constructor and move assignment using the
  <code>= delete</code> syntax in the exact same way you can delete the copy
  constructor and copy assignment.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Name</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-217-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_name <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-213-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-213-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-205-close">(</span>std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-205-open">)</span> <span class="token operator">:</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-214-close">{</span> name <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-214-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-215-close">{</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-215-open">}</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-206-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-206-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-207-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-207-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-208-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-208-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-209-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-209-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-210-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-210-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-216-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-216-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-217-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-211-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-211-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-220-close">{</span>
    Name n1<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-218-close">{</span> <span class="token string">"Alex"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-218-open">}</span><span class="token punctuation">;</span>
    n1 <span class="token operator">=</span> Name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-219-close">{</span> <span class="token string">"Joe"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-219-open">}</span><span class="token punctuation">;</span> <span class="token comment">// error: move assignment deleted</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> n1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-212-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-212-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-220-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  If you delete the copy constructor, the compiler will not generate an implicit
  move constructor (making your objects neither copyable nor movable).
  Therefore, when deleting the copy constructor, it is useful to be explicit
  about what behavior you want from your move constructors. Either explicitly
  delete them (making it clear this is the desired behavior), or default them
  (making the class move-only).
</p>
<div class="cpp-note cpp-lightbluebackground">
  <p class="cpp-note-title cpp-bottomline">Key insight</p>
  <p>
    The <strong>rule of five</strong> says that if the copy constructor, copy
    assignment, move constructor, move assignment, or destructor are defined or
    deleted, then each of those functions should be defined or deleted.
  </p>
</div>
<p>
  While deleting only the move constructor and move assignment may seem like a
  good idea if you want a copyable but not movable object, this has the
  unfortunate consequence of making the class not returnable by value in cases
  where mandatory copy elision does not apply. This happens because a deleted
  move constructor is still a declared function, and thus is eligible for
  overload resolution. And return by value will favor a deleted move constructor
  over a non-deleted copy constructor. This is illustrated by the following
  program:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Name</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-235-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_name <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-231-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-231-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-221-close">(</span>std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-221-open">)</span> <span class="token operator">:</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-232-close">{</span> name <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-232-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-233-close">{</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-233-open">}</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-222-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-222-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-223-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-223-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-224-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-224-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-225-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-225-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-226-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-226-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-234-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-234-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-235-open">}</span><span class="token punctuation">;</span>

Name <span class="token function">getJoe</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-227-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-227-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-237-close">{</span>
    Name joe<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-236-close">{</span> <span class="token string">"Joe"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-236-open">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> joe<span class="token punctuation">;</span> <span class="token comment">// error: Move constructor was deleted</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-237-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-228-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-228-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-239-close">{</span>
    Name n<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-238-close">{</span> <span class="token function">getJoe</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-229-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-229-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-238-open">}</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> n<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-230-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-230-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-239-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p class="cpp-section cpp-topline" style="clear: both">
  Issues with move semantics and <code>std::swap</code>
  <span class="cpp-section-pill cpp-section-advanced">Advanced</span>
</p>
<p>
  In lesson
  <a
    href="https://www.learncpp.com/cpp-tutorial/overloading-the-assignment-operator/"
    >21.12 -- Overloading the assignment operator</a
  >, we mentioned the copy and swap idiom. Copy and swap also works for move
  semantics, meaning we can implement our move constructor and move assignment
  by swapping resources with the object that will be destroyed.
</p>
<p>This has two benefits:</p>
<ul>
  <li>
    The persistent object now controls the resources that were previously under
    ownership of the dying object (which was our primary goal).
  </li>
  <li>
    The dying object now controls the resources that were previously under
    ownership of the persistent object. When the dying object actually dies, it
    can do any kind of cleanup required on those resources.
  </li>
</ul>
<p>
  When you think about swapping, the first thing that comes to mind is usually
  <code>std::swap()</code>. However, implementing the move constructor and move
  assignment using <code>std::swap()</code> is problematic, as
  <code>std::swap()</code> calls both the move constructor and move assignment
  on move-capable objects. This will result in an infinite recursion issue.
</p>
<p>You can see this happen in the following example:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Name</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-256-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_name <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-250-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-250-open">}</span><span class="token punctuation">;</span> <span class="token comment">// std::string is move capable</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-240-close">(</span>std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-240-open">)</span> <span class="token operator">:</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-251-close">{</span> name <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-251-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-252-close">{</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-252-open">}</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-241-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-241-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-242-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-242-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-243-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-243-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-253-close">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Move ctor\n"</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-244-close">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> name<span class="token punctuation brace-round brace-close brace-level-3" id="pair-244-open">)</span><span class="token punctuation">;</span> <span class="token comment">// bad!</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-253-open">}</span>

    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-245-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-245-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-254-close">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Move assign\n"</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-246-close">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> name<span class="token punctuation brace-round brace-close brace-level-3" id="pair-246-open">)</span><span class="token punctuation">;</span> <span class="token comment">// bad!</span>

        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-254-open">}</span>

    <span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-247-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-247-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-255-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-255-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-256-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-248-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-248-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-259-close">{</span>
    Name n1<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-257-close">{</span> <span class="token string">"Alex"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-257-open">}</span><span class="token punctuation">;</span>
    n1 <span class="token operator">=</span> Name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-258-close">{</span><span class="token string">"Joe"</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-258-open">}</span><span class="token punctuation">;</span> <span class="token comment">// invokes move assignment</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> n1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-249-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-249-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-259-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>This prints:</p>
<pre>
Move assign
Move ctor
Move ctor
Move ctor
Move ctor
</pre>
<p>And so on… until the stack overflows.</p>
<p>
  You can implement the move constructor and move assignment using your own swap
  function, as long as your swap member function does not call the move
  constructor or move assignment. Here’s an example of how that can be done:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Name</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-279-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_name <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-272-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-272-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-260-close">(</span>std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-260-open">)</span> <span class="token operator">:</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-273-close">{</span> name <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-273-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-274-close">{</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-274-open">}</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-261-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-261-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>
    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-262-close">(</span><span class="token keyword keyword-const">const</span> Name<span class="token operator">&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-262-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">;</span>

    <span class="token comment">// Create our own swap friend function to swap the members of Name</span>
    <span class="token keyword keyword-friend">friend</span> <span class="token keyword keyword-void">void</span> <span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-263-close">(</span>Name<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> Name<span class="token operator">&amp;</span> b<span class="token punctuation brace-round brace-close brace-level-2" id="pair-263-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-275-close">{</span>
        <span class="token comment">// We avoid recursive calls by invoking std::swap on the std::string member,</span>
        <span class="token comment">// not on Name</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-264-close">(</span>a<span class="token punctuation">.</span>m_name<span class="token punctuation">,</span> b<span class="token punctuation">.</span>m_name<span class="token punctuation brace-round brace-close brace-level-3" id="pair-264-open">)</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-275-open">}</span>

    <span class="token function">Name</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-265-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-265-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-276-close">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Move ctor\n"</span><span class="token punctuation">;</span>

        <span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-266-close">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> name<span class="token punctuation brace-round brace-close brace-level-3" id="pair-266-open">)</span><span class="token punctuation">;</span> <span class="token comment">// Now calling our swap, not std::swap</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-276-open">}</span>

    Name<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-267-close">(</span>Name<span class="token operator">&amp;&amp;</span> name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-267-open">)</span> <span class="token keyword keyword-noexcept">noexcept</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-277-close">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Move assign\n"</span><span class="token punctuation">;</span>

        <span class="token function">swap</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-268-close">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> name<span class="token punctuation brace-round brace-close brace-level-3" id="pair-268-open">)</span><span class="token punctuation">;</span> <span class="token comment">// Now calling our swap, not std::swap</span>

        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-277-open">}</span>

    <span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-269-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-269-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-278-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-278-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-279-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-270-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-270-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-282-close">{</span>
    Name n1<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-280-close">{</span> <span class="token string">"Alex"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-280-open">}</span><span class="token punctuation">;</span>
    n1 <span class="token operator">=</span> Name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-281-close">{</span><span class="token string">"Joe"</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-281-open">}</span><span class="token punctuation">;</span> <span class="token comment">// invokes move assignment</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> n1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-271-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-271-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-282-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>This works as expected, and prints:</p>
<pre>
Move assign
Joe
</pre>
<div class="prevnext">
  <div class="prevnext-inline">
    <a class="nav-link" href="https://www.learncpp.com/cpp-tutorial/stdmove/">
      <div class="nav-button nav-button-next">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-right" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Next lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">22.4</span>std::move
          </div>
        </div>
      </div></a
    >
    <a class="nav-link" href="/">
      <div class="nav-button nav-button-index">
        <div class="nav-button-icon">
          <i class="fa fa-home" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Back to table of contents</div>
        </div>
      </div></a
    >
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/rvalue-references/"
    >
      <div class="nav-button nav-button-prev">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-left" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Previous lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">22.2</span>R-value references
          </div>
        </div>
      </div></a
    >
  </div>
</div>
<div class="code-block code-block-10" style="margin: 8px 0; clear: both"></div>

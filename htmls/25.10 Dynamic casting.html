<div
  class="code-block code-block-1"
  style="margin: 8px 8px 8px 0; float: left"
></div>
<p>
  Way back in lesson
  <a
    href="https://www.learncpp.com/cpp-tutorial/explicit-type-conversion-casting-and-static-cast/"
    >10.6 -- Explicit type conversion (casting) and static_cast</a
  >, we examined the concept of casting, and the use of static_cast to convert
  variables from one type to another.
</p>
<p>
  In this lesson, we’ll continue by examining another type of cast:
  dynamic_cast.
</p>
<p><strong>The need for dynamic_cast</strong></p>
<p>
  When dealing with polymorphism, you’ll often encounter cases where you have a
  pointer to a base class, but you want to access some information that exists
  only in a derived class.
</p>
<p>Consider the following (slightly contrived) program:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-11-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> m_value<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-8-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-8-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-0-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation brace-round brace-close brace-level-2" id="pair-0-open">)</span>
		<span class="token operator">:</span> m_value<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-9-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-9-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-10-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-10-open">}</span>

	<span class="token keyword keyword-virtual">virtual</span> <span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-1-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-1-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-11-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-17-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-12-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-12-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Derived</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-2-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-2-open">)</span>
		<span class="token operator">:</span> Base<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-13-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-13-open">}</span><span class="token punctuation">,</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-14-close">{</span>name<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-14-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-15-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-15-open">}</span>

	<span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-3-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-3-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-16-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-16-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-17-open">}</span><span class="token punctuation">;</span>

Base<span class="token operator">*</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-4-close">(</span><span class="token keyword keyword-bool">bool</span> returnDerived<span class="token punctuation brace-round brace-close brace-level-1" id="pair-4-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-20-close">{</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-5-close">(</span>returnDerived<span class="token punctuation brace-round brace-close brace-level-2" id="pair-5-open">)</span>
		<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> Derived<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-18-close">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Apple"</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-18-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-else">else</span>
		<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> Base<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-19-close">{</span><span class="token number">2</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-19-open">}</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-20-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-6-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-6-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-22-close">{</span>
	Base<span class="token operator">*</span> b<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-21-close">{</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-7-close">(</span><span class="token boolean">true</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-7-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-21-open">}</span><span class="token punctuation">;</span>

	<span class="token comment">// how do we print the Derived object's name here, having only a Base pointer?</span>

	<span class="token keyword keyword-delete">delete</span> b<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-22-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  In this program, function getObject() always returns a Base pointer, but that
  pointer may be pointing to either a Base or a Derived object. In the case
  where the Base pointer is actually pointing to a Derived object, how would we
  call Derived::getName()?
</p>
<div class="code-block code-block-2" style="margin: 8px 0; clear: both"></div>

<p>
  One way would be to add a virtual function to Base called getName() (so we
  could call it with a Base pointer/reference, and have it dynamically resolve
  to Derived::getName()). But what would this function return if you called it
  with a Base pointer/reference that was actually pointing to a Base object?
  There isn’t really any value that makes sense. Furthermore, we would be
  polluting our Base class with things that really should only be the concern of
  the Derived class.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_5_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_5"
        name="aswift_5"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2873098&amp;adf=122393884&amp;pi=t.aa~a.3048083739~i.18~rp.4&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1751033797&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fdynamic-casting%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963652498&amp;bpp=2&amp;bdt=1042&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600&amp;nras=2&amp;correlator=5445076843081&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=1480&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C42532524%2C95353387%2C95362656%2C95365226%2C95365234%2C95365108%2C95359266%2C95365116%2C95365797%2C31092546&amp;oid=2&amp;pvsid=8390296425498766&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=6&amp;uci=a!6&amp;btvi=1&amp;fsb=1&amp;dtd=6"
        data-google-container-id="a!6"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CNev8pjtrI4DFcKH6QUdagAcPg"
      ></iframe></div
  ></ins>
</div>
<p>
  We know that C++ will implicitly let you convert a Derived pointer into a Base
  pointer (in fact, getObject() does just that). This process is sometimes
  called <strong>upcasting</strong>. However, what if there was a way to convert
  a Base pointer back into a Derived pointer? Then we could call
  Derived::getName() directly using that pointer, and not have to worry about
  virtual function resolution at all.
</p>
<p><strong>dynamic_cast</strong></p>
<p>
  C++ provides a casting operator named <strong>dynamic_cast</strong> that can
  be used for just this purpose. Although dynamic casts have a few different
  capabilities, by far the most common use for dynamic casting is for converting
  base-class pointers into derived-class pointers. This process is called
  <strong>downcasting</strong>.
</p>
<p>
  Using dynamic_cast works just like static_cast. Here’s our example main() from
  above, using a dynamic_cast to convert our Base pointer back into a Derived
  pointer:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-23-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-23-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-29-close">{</span>
	Base<span class="token operator">*</span> b<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-27-close">{</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-24-close">(</span><span class="token boolean">true</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-24-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-27-open">}</span><span class="token punctuation">;</span>

	Derived<span class="token operator">*</span> d<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-28-close">{</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-25-close">(</span>b<span class="token punctuation brace-round brace-close brace-level-3" id="pair-25-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-28-open">}</span><span class="token punctuation">;</span> <span class="token comment">// use dynamic cast to convert Base pointer into Derived pointer</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The name of the Derived is: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-26-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-26-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-delete">delete</span> b<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-29-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>This prints:</p>
<pre>
The name of the Derived is: Apple
</pre>
<p><strong>dynamic_cast failure</strong></p>
<p>
  The above example works because b is actually pointing to a Derived object, so
  converting b into a Derived pointer is successful.
</p>
<div class="code-block code-block-3" style="margin: 8px 0; clear: both"></div>

<p>
  However, we’ve made quite a dangerous assumption: that b is pointing to a
  Derived object. What if b wasn’t pointing to a Derived object? This is easily
  tested by changing the argument to getObject() from true to false. In that
  case, getObject() will return a Base pointer to a Base object. When we try to
  dynamic_cast that to a Derived, it will fail, because the conversion can’t be
  made.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_6_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_6"
        name="aswift_6"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2873098&amp;adf=362442094&amp;pi=t.aa~a.3048083739~i.39~rp.4&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1751033797&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fdynamic-casting%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963652498&amp;bpp=1&amp;bdt=1042&amp;idt=0&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280&amp;nras=3&amp;correlator=5445076843081&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=2443&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C42532524%2C95353387%2C95362656%2C95365226%2C95365234%2C95365108%2C95359266%2C95365116%2C95365797%2C31092546&amp;oid=2&amp;pvsid=8390296425498766&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=7&amp;uci=a!7&amp;btvi=2&amp;fsb=1&amp;dtd=7"
        data-google-container-id="a!7"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CPK48pjtrI4DFa2H6QUdCaQ6Ag"
      ></iframe></div
  ></ins>
</div>
<p>
  If a dynamic_cast fails, the result of the conversion will be a null pointer.
</p>
<p>
  Because we haven’t checked for a null pointer result, we access
  d-&gt;getName(), which will try to dereference a null pointer, leading to
  undefined behavior (probably a crash).
</p>
<p>
  In order to make this program safe, we need to ensure the result of the
  dynamic_cast actually succeeded:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-30-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-30-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-37-close">{</span>
	Base<span class="token operator">*</span> b<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-35-close">{</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-31-close">(</span><span class="token boolean">true</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-31-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-35-open">}</span><span class="token punctuation">;</span>

	Derived<span class="token operator">*</span> d<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-36-close">{</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-32-close">(</span>b<span class="token punctuation brace-round brace-close brace-level-3" id="pair-32-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-36-open">}</span><span class="token punctuation">;</span> <span class="token comment">// use dynamic cast to convert Base pointer into Derived pointer</span>

	<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-33-close">(</span>d<span class="token punctuation brace-round brace-close brace-level-2" id="pair-33-open">)</span> <span class="token comment">// make sure d is non-null</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The name of the Derived is: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-34-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-34-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-delete">delete</span> b<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-37-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<div class="cpp-note cpp-lightpurplebackground">
  <p class="cpp-note-title cpp-bottomline">Rule</p>
  <p>
    Always ensure your dynamic casts actually succeeded by checking for a null
    pointer result.
  </p>
</div>
<p>
  Note that because dynamic_cast does some consistency checking at runtime (to
  ensure the conversion can be made), use of dynamic_cast does incur a
  performance penalty.
</p>
<div
  class="google-auto-placed"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: 8px auto 14px;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_7_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_7"
        name="aswift_7"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=2077728709&amp;adf=2362645516&amp;pi=t.aa~a.1825356541~rp.1&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1751033797&amp;rafmt=1&amp;to=qs&amp;pwprc=4633386603&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fdynamic-casting%2F&amp;fwr=0&amp;pra=3&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=40&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963652553&amp;bpp=1&amp;bdt=1097&amp;idt=0&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963528%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963528%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280&amp;nras=4&amp;correlator=5445076843081&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3256&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093235%2C42532524%2C95353387%2C95362656%2C95365226%2C95365234%2C95365108%2C95359266%2C95365116%2C95365797%2C31092546&amp;oid=2&amp;pvsid=8390296425498766&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=8&amp;uci=a!8&amp;btvi=3&amp;fsb=1&amp;dtd=10"
        data-google-container-id="a!8"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CPXc9ZjtrI4DFTOG6QUdwgcmlQ"
      ></iframe></div
  ></ins>
</div>
<div class="code-block code-block-4" style="margin: 8px 0; clear: both"></div>

<p>
  Also note that there are several cases where downcasting using dynamic_cast
  will not work:
</p>
<ol start="1">
  <li>With protected or private inheritance.</li>
  <li>
    For classes that do not declare or inherit any virtual functions (and thus
    don’t have a virtual table).
  </li>
  <li>
    In certain cases involving virtual base classes (see
    <a href="https://msdn.microsoft.com/en-us/library/cby9kycs.aspx"
      >this page</a
    >
    for an example of some of these cases, and how to resolve them).
  </li>
</ol>
<p><strong>Downcasting with static_cast</strong></p>
<p>
  It turns out that downcasting can also be done with static_cast. The main
  difference is that static_cast does no runtime type checking to ensure that
  what you’re doing makes sense. This makes using static_cast faster, but more
  dangerous. If you cast a Base* to a Derived*, it will “succeed” even if the
  Base pointer isn’t pointing to a Derived object. This will result in undefined
  behavior when you try to access the resulting Derived pointer (that is
  actually pointing to a Base object).
</p>
<p>
  If you’re absolutely sure that the pointer you’re downcasting will succeed,
  then using static_cast is acceptable. One way to ensure that you know what
  type of object you’re pointing to is to use a virtual function. Here’s one
  (not great) way to do that:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token comment">// Class identifier</span>
<span class="token keyword keyword-enum">enum</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ClassID</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-52-close">{</span>
	base<span class="token punctuation">,</span>
	derived
	<span class="token comment">// Others can be added here later</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-52-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-57-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> m_value<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-53-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-53-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-38-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation brace-round brace-close brace-level-2" id="pair-38-open">)</span>
		<span class="token operator">:</span> m_value<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-54-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-54-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-55-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-55-open">}</span>

	<span class="token keyword keyword-virtual">virtual</span> <span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-39-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-39-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-virtual">virtual</span> ClassID <span class="token function">getClassID</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-40-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-40-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-56-close">{</span> <span class="token keyword keyword-return">return</span> ClassID<span class="token double-colon punctuation">::</span>base<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-56-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-57-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-64-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-58-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-58-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Derived</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-41-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-41-open">)</span>
		<span class="token operator">:</span> Base<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-59-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-59-open">}</span><span class="token punctuation">,</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-60-close">{</span>name<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-60-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-61-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-61-open">}</span>

	<span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-42-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-42-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-62-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-62-open">}</span>
	ClassID <span class="token function">getClassID</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-43-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-43-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-63-close">{</span> <span class="token keyword keyword-return">return</span> ClassID<span class="token double-colon punctuation">::</span>derived<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-63-open">}</span>

<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-64-open">}</span><span class="token punctuation">;</span>

Base<span class="token operator">*</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-44-close">(</span><span class="token keyword keyword-bool">bool</span> bReturnDerived<span class="token punctuation brace-round brace-close brace-level-1" id="pair-44-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-67-close">{</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-45-close">(</span>bReturnDerived<span class="token punctuation brace-round brace-close brace-level-2" id="pair-45-open">)</span>
		<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> Derived<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-65-close">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Apple"</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-65-open">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-else">else</span>
		<span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> Base<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-66-close">{</span><span class="token number">2</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-66-open">}</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-67-open">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-46-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-46-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-71-close">{</span>
	Base<span class="token operator">*</span> b<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-68-close">{</span> <span class="token function">getObject</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-47-close">(</span><span class="token boolean">true</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-47-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-68-open">}</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-49-close">(</span>b<span class="token operator">-&gt;</span><span class="token function">getClassID</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-48-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-48-open">)</span> <span class="token operator">==</span> ClassID<span class="token double-colon punctuation">::</span>derived<span class="token punctuation brace-round brace-close brace-level-2" id="pair-49-open">)</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-70-close">{</span>
		<span class="token comment">// We already proved b is pointing to a Derived object, so this should always succeed</span>
		Derived<span class="token operator">*</span> d<span class="token punctuation brace-curly brace-open brace-level-3" id="pair-69-close">{</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-4" id="pair-50-close">(</span>b<span class="token punctuation brace-round brace-close brace-level-4" id="pair-50-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-69-open">}</span><span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The name of the Derived is: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-51-close">(</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-51-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-70-open">}</span>

	<span class="token keyword keyword-delete">delete</span> b<span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-71-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  But if you’re going to go through all of the trouble to implement this (and
  pay the cost of calling a virtual function and processing the result), you
  might as well just use dynamic_cast.
</p>
<p>
  Also consider what would happen if our object were actually some class that is
  derived from Derived (let’s call it <code>D2</code>). The above check
  <code>b-&gt;getClassID() == ClassID::derived</code> will fail because
  <code>getClassId()</code> would return <code>ClassID::D2</code>, which is not
  equal to <code>ClassID::derived</code>. Dynamic casting <code>D2</code> to
  <code>Derived</code> would succeed though, since a <code>D2</code> is a
  <code>Derived</code>!
</p>
<div
  class="google-auto-placed"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: 8px auto 14px;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_8_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<div class="code-block code-block-5" style="margin: 8px 0; clear: both"></div>

<p><strong>dynamic_cast and references</strong></p>
<p>
  Although all of the above examples show dynamic casting of pointers (which is
  more common), dynamic_cast can also be used with references. This works
  analogously to how dynamic_cast works with pointers.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string_view&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Base</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-81-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	<span class="token keyword keyword-int">int</span> m_value<span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-72-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation brace-round brace-close brace-level-2" id="pair-72-open">)</span>
		<span class="token operator">:</span> m_value<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-79-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-79-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-80-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-80-open">}</span>

	<span class="token keyword keyword-virtual">virtual</span> <span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-73-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-73-open">)</span> <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-81-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">Base</span></span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-86-close">{</span>
<span class="token keyword keyword-protected">protected</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string m_name<span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
	<span class="token function">Derived</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-74-close">(</span><span class="token keyword keyword-int">int</span> value<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string_view name<span class="token punctuation brace-round brace-close brace-level-2" id="pair-74-open">)</span>
		<span class="token operator">:</span> Base<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-82-close">{</span>value<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-82-open">}</span><span class="token punctuation">,</span> m_name<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-83-close">{</span>name<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-83-open">}</span>
	<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-84-close">{</span>
	<span class="token punctuation brace-curly brace-close brace-level-2" id="pair-84-open">}</span>

	<span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-75-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-75-open">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-85-close">{</span> <span class="token keyword keyword-return">return</span> m_name<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-85-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-86-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-76-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-76-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-90-close">{</span>
	Derived apple<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-87-close">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Apple"</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-87-open">}</span><span class="token punctuation">;</span> <span class="token comment">// create an apple</span>
	Base<span class="token operator">&amp;</span> b<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-88-close">{</span> apple <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-88-open">}</span><span class="token punctuation">;</span> <span class="token comment">// set base reference to object</span>
	Derived<span class="token operator">&amp;</span> d<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-89-close">{</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-77-close">(</span>b<span class="token punctuation brace-round brace-close brace-level-3" id="pair-77-open">)</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-89-open">}</span><span class="token punctuation">;</span> <span class="token comment">// dynamic cast using a reference instead of a pointer</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The name of the Derived is: "</span> <span class="token operator">&lt;&lt;</span> d<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-78-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-78-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// we can access Derived::getName through d</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-90-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Because C++ does not have a “null reference”, dynamic_cast can’t return a null
  reference upon failure. Instead, if the dynamic_cast of a reference fails, an
  exception of type std::bad_cast is thrown. We talk about exceptions later in
  this tutorial.
</p>
<p><strong>dynamic_cast vs static_cast</strong></p>
<p>
  New programmers are sometimes confused about when to use static_cast vs
  dynamic_cast. The answer is quite simple: use static_cast unless you’re
  downcasting, in which case dynamic_cast is usually a better choice. However,
  you should also consider avoiding casting altogether and just use virtual
  functions.
</p>
<p><strong>Downcasting vs virtual functions</strong></p>
<p>
  There are some developers who believe dynamic_cast is evil and indicative of a
  bad class design. Instead, these programmers say you should use virtual
  functions.
</p>
<p>
  In general, using a virtual function <em>should</em> be preferred over
  downcasting. However, there are times when downcasting is the better choice:
</p>
<div class="code-block code-block-6" style="margin: 8px 0; clear: both"></div>

<ul>
  <li>
    When you can not modify the base class to add a virtual function (e.g.
    because the base class is part of the standard library)
  </li>
  <li>
    When you need access to something that is derived-class specific (e.g. an
    access function that only exists in the derived class)
  </li>
  <li>
    When adding a virtual function to your base class doesn’t make sense (e.g.
    there is no appropriate value for the base class to return). Using a pure
    virtual function may be an option here if you don’t need to instantiate the
    base class.
  </li>
</ul>
<p><strong>A warning about dynamic_cast and RTTI</strong></p>
<p>
  Run-time type information (RTTI) is a feature of C++ that exposes information
  about an object’s data type at runtime. This capability is leveraged by
  dynamic_cast. Because RTTI has a pretty significant space performance cost,
  some compilers allow you to turn RTTI off as an optimization. Needless to say,
  if you do this, dynamic_cast won’t function correctly.
</p>
<div class="prevnext">
  <div class="prevnext-inline">
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/printing-inherited-classes-using-operator/"
    >
      <div class="nav-button nav-button-next">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-right" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Next lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">25.11</span>Printing
            inherited classes using operator&lt;&lt;
          </div>
        </div>
      </div></a
    >
    <a class="nav-link" href="/">
      <div class="nav-button nav-button-index">
        <div class="nav-button-icon">
          <i class="fa fa-home" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Back to table of contents</div>
        </div>
      </div></a
    >
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/object-slicing/"
    >
      <div class="nav-button nav-button-prev">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-left" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Previous lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">25.9</span>Object slicing
          </div>
        </div>
      </div></a
    >
  </div>
</div>
<div class="code-block code-block-10" style="margin: 8px 0; clear: both"></div>

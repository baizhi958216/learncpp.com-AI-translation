<div
  class="code-block code-block-1"
  style="margin: 8px 8px 8px 0; float: left"
></div>
<p class="cpp-section cpp-topline" style="clear: both">Shallow copying</p>
<p>
  Because C++ does not know much about your class, the default copy constructor
  and default assignment operators it provides use a copying method known as a
  memberwise copy (also known as a <strong>shallow copy</strong>). This means
  that C++ copies each member of the class individually (using the assignment
  operator for overloaded operator=, and direct initialization for the copy
  constructor). When classes are simple (e.g. do not contain any dynamically
  allocated memory), this works very well.
</p>
<p>For example, let’s take a look at our Fraction class:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Fraction</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-9-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> m_numerator <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-4-close">{</span> <span class="token number">0</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-4-open">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> m_denominator <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-5-close">{</span> <span class="token number">1</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-5-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token comment">// Default constructor</span>
    <span class="token function">Fraction</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-0-close">(</span><span class="token keyword keyword-int">int</span> numerator <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> denominator <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-0-open">)</span>
        <span class="token operator">:</span> m_numerator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-6-close">{</span> numerator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-6-open">}</span>
        <span class="token punctuation">,</span> m_denominator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-7-close">{</span> denominator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-7-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-8-close">{</span>
        <span class="token function">assert</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-1-close">(</span>denominator <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-1-open">)</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-8-open">}</span>

    <span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-2-close">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> out<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Fraction<span class="token operator">&amp;</span> f1<span class="token punctuation brace-round brace-close brace-level-2" id="pair-2-open">)</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-9-open">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-3-close">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> out<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Fraction<span class="token operator">&amp;</span> f1<span class="token punctuation brace-round brace-close brace-level-1" id="pair-3-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-10-close">{</span>
	out <span class="token operator">&lt;&lt;</span> f1<span class="token punctuation">.</span>m_numerator <span class="token operator">&lt;&lt;</span> <span class="token string">'/'</span> <span class="token operator">&lt;&lt;</span> f1<span class="token punctuation">.</span>m_denominator<span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-10-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<div
  class="google-auto-placed"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: 10px auto 14px;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_10_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_10"
        name="aswift_10"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1822546688&amp;adf=765616280&amp;pi=t.aa~a.308122700~rp.1&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750100472&amp;rafmt=1&amp;to=qs&amp;pwprc=4633386603&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fshallow-vs-deep-copying%2F&amp;fwr=0&amp;pra=3&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=40&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963357897&amp;bpp=1&amp;bdt=1241&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280&amp;nras=4&amp;correlator=6714010531513&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=1121&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C31093234%2C42531706%2C95331833%2C95353386%2C95362655%2C95365226%2C95365235%2C95365461%2C95344787%2C95359266%2C95365115%2C95365798&amp;oid=2&amp;pvsid=4435782446458034&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=11&amp;uci=a!b&amp;btvi=3&amp;fsb=1&amp;dtd=14"
        data-google-container-id="a!b"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CL7ktYzsrI4DFUKG6QUd_DMfJQ"
      ></iframe></div
  ></ins>
</div>
<p>
  The default copy constructor and default assignment operator provided by the
  compiler for this class look something like this:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Fraction</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-27-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-int">int</span> m_numerator <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-17-close">{</span> <span class="token number">0</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-17-open">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> m_denominator <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-18-close">{</span> <span class="token number">1</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-18-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token comment">// Default constructor</span>
    <span class="token function">Fraction</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-11-close">(</span><span class="token keyword keyword-int">int</span> numerator <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> denominator <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-11-open">)</span>
        <span class="token operator">:</span> m_numerator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-19-close">{</span> numerator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-19-open">}</span>
        <span class="token punctuation">,</span> m_denominator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-20-close">{</span> denominator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-20-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-21-close">{</span>
        <span class="token function">assert</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-12-close">(</span>denominator <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation brace-round brace-close brace-level-3" id="pair-12-open">)</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-21-open">}</span>

    <span class="token comment">// Possible implementation of implicit copy constructor</span>
    <span class="token function">Fraction</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-13-close">(</span><span class="token keyword keyword-const">const</span> Fraction<span class="token operator">&amp;</span> f<span class="token punctuation brace-round brace-close brace-level-2" id="pair-13-open">)</span>
        <span class="token operator">:</span> m_numerator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-22-close">{</span> f<span class="token punctuation">.</span>m_numerator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-22-open">}</span>
        <span class="token punctuation">,</span> m_denominator<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-23-close">{</span> f<span class="token punctuation">.</span>m_denominator <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-23-open">}</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-24-close">{</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-24-open">}</span>

    <span class="token comment">// Possible implementation of implicit assignment operator</span>
    Fraction<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">=</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-14-close">(</span><span class="token keyword keyword-const">const</span> Fraction<span class="token operator">&amp;</span> fraction<span class="token punctuation brace-round brace-close brace-level-2" id="pair-14-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-25-close">{</span>
        <span class="token comment">// self-assignment guard</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-15-close">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> <span class="token operator">&amp;</span>fraction<span class="token punctuation brace-round brace-close brace-level-3" id="pair-15-open">)</span>
            <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>

        <span class="token comment">// do the copy</span>
        m_numerator <span class="token operator">=</span> fraction<span class="token punctuation">.</span>m_numerator<span class="token punctuation">;</span>
        m_denominator <span class="token operator">=</span> fraction<span class="token punctuation">.</span>m_denominator<span class="token punctuation">;</span>

        <span class="token comment">// return the existing object so we can chain this operator</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-25-open">}</span>

    <span class="token keyword keyword-friend">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-16-close">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> out<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Fraction<span class="token operator">&amp;</span> f1<span class="token punctuation brace-round brace-close brace-level-2" id="pair-16-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-26-close">{</span>
	out <span class="token operator">&lt;&lt;</span> f1<span class="token punctuation">.</span>m_numerator <span class="token operator">&lt;&lt;</span> <span class="token string">'/'</span> <span class="token operator">&lt;&lt;</span> f1<span class="token punctuation">.</span>m_denominator<span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> out<span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-26-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-27-open">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Note that because these default versions work just fine for copying this
  class, there’s really no reason to write our own version of these functions in
  this case.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_5_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_5"
        name="aswift_5"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=877580301&amp;adf=2873234428&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750100472&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fshallow-vs-deep-copying%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963357842&amp;bpp=1&amp;bdt=1186&amp;idt=-M&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600&amp;nras=2&amp;correlator=6714010531513&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=1972&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C31093234%2C42531706%2C95331833%2C95353386%2C95362655%2C95365226%2C95365235%2C95365461%2C95344787%2C95359266%2C95365115%2C95365798&amp;oid=2&amp;pvsid=4435782446458034&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=6&amp;uci=a!6&amp;btvi=1&amp;fsb=1&amp;dtd=11"
        data-google-container-id="a!6"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-google-query-id="CMX_sYzsrI4DFSmJ6QUdj58mhQ"
        data-load-complete="true"
      ></iframe></div
  ></ins>
</div>
<p>
  However, when designing classes that handle dynamically allocated memory,
  memberwise (shallow) copying can get us in a lot of trouble! This is because
  shallow copies of a pointer just copy the address of the pointer -- it does
  not allocate any memory or copy the contents being pointed to!
</p>
<div class="code-block code-block-2" style="margin: 8px 0; clear: both"></div>

<p>Let’s take a look at an example of this:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span> <span class="token comment">// for strlen()</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert&gt;</span> <span class="token comment">// for assert()</span></span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">MyString</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-46-close">{</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-char">char</span><span class="token operator">*</span> m_data<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-39-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-39-open">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> m_length<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-40-close">{</span><span class="token punctuation brace-curly brace-close brace-level-2" id="pair-40-open">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">MyString</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-28-close">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> source <span class="token operator">=</span> <span class="token string">""</span> <span class="token punctuation brace-round brace-close brace-level-2" id="pair-28-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-42-close">{</span>
        <span class="token function">assert</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-29-close">(</span>source<span class="token punctuation brace-round brace-close brace-level-3" id="pair-29-open">)</span><span class="token punctuation">;</span> <span class="token comment">// make sure source isn't a null string</span>

        <span class="token comment">// Find the length of the string</span>
        <span class="token comment">// Plus one character for a terminator</span>
        m_length <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">strlen</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-30-close">(</span>source<span class="token punctuation brace-round brace-close brace-level-3" id="pair-30-open">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token comment">// Allocate a buffer equal to this length</span>
        m_data <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-35-close">[</span>m_length<span class="token punctuation brace-square brace-close brace-level-3" id="pair-35-open">]</span><span class="token punctuation">;</span>

        <span class="token comment">// Copy the parameter string into our internal buffer</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-31-close">(</span><span class="token keyword keyword-int">int</span> i<span class="token punctuation brace-curly brace-open brace-level-4" id="pair-41-close">{</span> <span class="token number">0</span> <span class="token punctuation brace-curly brace-close brace-level-4" id="pair-41-open">}</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation brace-round brace-close brace-level-3" id="pair-31-open">)</span>
            m_data<span class="token punctuation brace-square brace-open brace-level-3" id="pair-36-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-3" id="pair-36-open">]</span> <span class="token operator">=</span> source<span class="token punctuation brace-square brace-open brace-level-3" id="pair-37-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-3" id="pair-37-open">]</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-42-open">}</span>

    <span class="token operator">~</span><span class="token function">MyString</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-32-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-32-open">)</span> <span class="token comment">// destructor</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-43-close">{</span>
        <span class="token comment">// We need to deallocate our string</span>
        <span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-38-close">[</span><span class="token punctuation brace-square brace-close brace-level-3" id="pair-38-open">]</span> m_data<span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-43-open">}</span>

    <span class="token keyword keyword-char">char</span><span class="token operator">*</span> <span class="token function">getString</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-33-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-33-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-44-close">{</span> <span class="token keyword keyword-return">return</span> m_data<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-44-open">}</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">getLength</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-34-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-34-open">)</span> <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-45-close">{</span> <span class="token keyword keyword-return">return</span> m_length<span class="token punctuation">;</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-45-open">}</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-46-open">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  The above is a simple string class that allocates memory to hold a string that
  we pass in. Note that we have not defined a copy constructor or overloaded
  assignment operator. Consequently, C++ will provide a default copy constructor
  and default assignment operator that do a shallow copy. The copy constructor
  will look something like this:
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token class-name">MyString</span><span class="token double-colon punctuation">::</span><span class="token function">MyString</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-47-close">(</span><span class="token keyword keyword-const">const</span> MyString<span class="token operator">&amp;</span> source<span class="token punctuation brace-round brace-close brace-level-1" id="pair-47-open">)</span>
    <span class="token operator">:</span> m_length <span class="token punctuation brace-curly brace-open brace-level-1" id="pair-48-close">{</span> source<span class="token punctuation">.</span>m_length <span class="token punctuation brace-curly brace-close brace-level-1" id="pair-48-open">}</span>
    <span class="token punctuation">,</span> m_data <span class="token punctuation brace-curly brace-open brace-level-1" id="pair-49-close">{</span> source<span class="token punctuation">.</span>m_data <span class="token punctuation brace-curly brace-close brace-level-1" id="pair-49-open">}</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-50-close">{</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-50-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Note that m_data is just a shallow pointer copy of source.m_data, meaning they
  now both point to the same thing.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_6_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_6"
        name="aswift_6"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=877580301&amp;adf=2760794709&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750100472&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fshallow-vs-deep-copying%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963357842&amp;bpp=1&amp;bdt=1186&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280&amp;nras=3&amp;correlator=6714010531513&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3186&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C31093234%2C42531706%2C95331833%2C95353386%2C95362655%2C95365226%2C95365235%2C95365461%2C95344787%2C95359266%2C95365115%2C95365798&amp;oid=2&amp;pvsid=4435782446458034&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=7&amp;uci=a!7&amp;btvi=2&amp;fsb=1&amp;dtd=12"
        data-google-container-id="a!7"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="COWhsozsrI4DFZiI6QUdQr8byw"
      ></iframe></div
  ></ins>
</div>
<p>Now, consider the following snippet of code:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-51-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-51-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-56-close">{</span>
    MyString hello<span class="token punctuation brace-curly brace-open brace-level-2" id="pair-53-close">{</span> <span class="token string">"Hello, world!"</span> <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-53-open">}</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-55-close">{</span>
        MyString copy<span class="token punctuation brace-curly brace-open brace-level-3" id="pair-54-close">{</span> hello <span class="token punctuation brace-curly brace-close brace-level-3" id="pair-54-open">}</span><span class="token punctuation">;</span> <span class="token comment">// use default copy constructor</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-55-open">}</span> <span class="token comment">// copy is a local variable, so it gets destroyed here.  The destructor deletes copy's string, which leaves hello with a dangling pointer</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> hello<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-52-close">(</span><span class="token punctuation brace-round brace-close brace-level-2" id="pair-52-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// this will have undefined behavior</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-56-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 32px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  While this code looks harmless enough, it contains an insidious problem that
  will cause the program to exhibit undefined behavior!
</p>
<div
  class="google-auto-placed"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: 8px auto 14px;
      background-color: transparent;
      height: 0px;
    "
    data-ad-status="unfilled"
    ><div
      id="aswift_11_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_11"
        name="aswift_11"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=1822546688&amp;adf=4050690692&amp;pi=t.aa~a.1825357540~rp.1&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750100472&amp;rafmt=1&amp;to=qs&amp;pwprc=4633386603&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fshallow-vs-deep-copying%2F&amp;fwr=0&amp;pra=3&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=40&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963357901&amp;bpp=1&amp;bdt=1245&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280%2C1027x280%2C1080x1024&amp;nras=6&amp;correlator=6714010531513&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3819&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C31093234%2C42531706%2C95331833%2C95353386%2C95362655%2C95365226%2C95365235%2C95365461%2C95344787%2C95359266%2C95365115%2C95365798&amp;oid=2&amp;pvsid=4435782446458034&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1920&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=12&amp;uci=a!c&amp;btvi=4&amp;fsb=1&amp;dtd=120"
        data-google-container-id="a!c"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-load-complete="true"
        data-google-query-id="CPK5vIzsrI4DFeWU6QUdBlA7Cw"
      ></iframe></div
  ></ins>
</div>
<div class="code-block code-block-3" style="margin: 8px 0; clear: both"></div>

<p>Let’s break down this example line by line:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp">MyString hello<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-57-close">{</span> <span class="token string">"Hello, world!"</span> <span class="token punctuation brace-curly brace-close brace-level-1" id="pair-57-open">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  This line is harmless enough. This calls the MyString constructor, which
  allocates some memory, sets hello.m_data to point to it, and then copies the
  string “Hello, world!” into it.
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp">MyString copy<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-58-close">{</span> hello <span class="token punctuation brace-curly brace-close brace-level-1" id="pair-58-open">}</span><span class="token punctuation">;</span> <span class="token comment">// use default copy constructor</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  This line seems harmless enough as well, but it’s actually the source of our
  problem! When this line is evaluated, C++ will use the default copy
  constructor (because we haven’t provided our own). This copy constructor will
  do a shallow copy, initializing copy.m_data to the same address of
  hello.m_data. As a result, copy.m_data and hello.m_data are now both pointing
  to the same piece of memory!
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token punctuation brace-curly brace-close brace-level-1">}</span> <span class="token comment">// copy gets destroyed here</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  When copy goes out of scope, the MyString destructor is called on copy. The
  destructor deletes the dynamically allocated memory that both copy.m_data and
  hello.m_data are pointing to! Consequently, by deleting copy, we’ve also
  (inadvertently) affected hello. Variable copy then gets destroyed, but
  hello.m_data is left pointing to the deleted (invalid) memory!
</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp">std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> hello<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-59-close">(</span><span class="token punctuation brace-round brace-close brace-level-1" id="pair-59-open">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// this will have undefined behavior</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Now you can see why this program has undefined behavior. We deleted the string
  that hello was pointing to, and now we are trying to print the value of memory
  that is no longer allocated.
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 0px;
    "
    ><div
      id="aswift_7_host"
      style="
        border: none;
        height: 0px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
        overflow: hidden;
        opacity: 0;
      "
    >
      <iframe
        id="aswift_7"
        name="aswift_7"
        browsingtopics="true"
        style="
          left: 0px;
          position: absolute;
          top: 0px;
          border: 0px;
          width: 1027px;
          height: 0px;
          min-height: auto;
          max-height: none;
          min-width: auto;
          max-width: none;
        "
        sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
        width="1027"
        height="0"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        vspace="0"
        hspace="0"
        allowtransparency="true"
        scrolling="no"
        allow="attribution-reporting; run-ad-auction"
        src="https://googleads.g.doubleclick.net/pagead/ads?client=ca-pub-0588844875925051&amp;output=html&amp;h=280&amp;adk=877580301&amp;adf=2514822099&amp;w=1027&amp;abgtt=11&amp;fwrn=4&amp;fwrnh=100&amp;lmt=1750100472&amp;num_ads=1&amp;rafmt=1&amp;armr=3&amp;sem=mc&amp;pwprc=4633386603&amp;ad_type=text_image&amp;format=1027x280&amp;url=https%3A%2F%2Fwww.learncpp.com%2Fcpp-tutorial%2Fshallow-vs-deep-copying%2F&amp;fwr=0&amp;pra=3&amp;rh=200&amp;rw=1026&amp;rpe=1&amp;resp_fmts=3&amp;wgl=1&amp;fa=27&amp;uach=WyJXaW5kb3dzIiwiMTkuMC4wIiwieDg2IiwiIiwiMTM3LjAuNzE1MS4xMjIiLG51bGwsMCxudWxsLCI2NCIsW1siR29vZ2xlIENocm9tZSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJDaHJvbWl1bSIsIjEzNy4wLjcxNTEuMTIyIl0sWyJOb3QvQSlCcmFuZCIsIjI0LjAuMC4wIl1dLDBd&amp;dt=1751963357844&amp;bpp=1&amp;bdt=1188&amp;idt=1&amp;shv=r20250702&amp;mjsv=m202507020101&amp;ptt=9&amp;saldr=aa&amp;abxe=1&amp;cookie=ID%3D05f6e82287d810b4%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MaQYA0TSAU2k8xwY5tqlN0xFCcd6g&amp;gpic=UID%3D00001157d9e27d0a%3AT%3D1751962604%3ART%3D1751963214%3AS%3DALNI_MYgtHzQJAQQXY_151HTGSSfVxE8_A&amp;eo_id_str=ID%3D52c21936d98c6d2b%3AT%3D1751962604%3ART%3D1751963214%3AS%3DAA-AfjZsJ15yjdEPJ8d11hPojsJQ&amp;prev_fmts=0x0%2C336x280%2C160x600%2C160x600%2C1027x280%2C1027x280%2C1027x280%2C1080x1024%2C1027x280&amp;nras=7&amp;correlator=6714010531513&amp;frm=20&amp;pv=1&amp;u_tz=480&amp;u_his=2&amp;u_h=600&amp;u_w=800&amp;u_ah=600&amp;u_aw=800&amp;u_cd=24&amp;u_sd=1&amp;dmc=8&amp;adx=27&amp;ady=3825&amp;biw=1080&amp;bih=1024&amp;scr_x=0&amp;scr_y=0&amp;eid=31093233%2C31093234%2C42531706%2C95331833%2C95353386%2C95362655%2C95365226%2C95365235%2C95365461%2C95344787%2C95359266%2C95365115%2C95365798&amp;oid=2&amp;pvsid=4435782446458034&amp;tmod=1708485235&amp;uas=0&amp;nvt=1&amp;fc=1408&amp;brdim=10%2C10%2C10%2C10%2C800%2C0%2C780%2C580%2C1080%2C1024&amp;vis=1&amp;rsz=%7C%7Cs%7C&amp;abl=NS&amp;fu=128&amp;bc=31&amp;bz=0.72&amp;td=1&amp;tdf=2&amp;psd=W251bGwsbnVsbCxudWxsLDNd&amp;nt=1&amp;ifi=8&amp;uci=a!8&amp;btvi=5&amp;fsb=1&amp;dtd=494"
        data-google-container-id="a!8"
        tabindex="0"
        title="Advertisement"
        aria-label="Advertisement"
        data-google-query-id="CLnwz4zsrI4DFc-S6QUdXpksPA"
        data-load-complete="true"
      ></iframe></div
  ></ins>
</div>
<div class="code-block code-block-4" style="margin: 8px 0; clear: both"></div>

<p>
  The root of this problem is the shallow copy done by the copy constructor --
  doing a shallow copy on pointer values in a copy constructor or overloaded
  assignment operator is almost always asking for trouble.
</p>
<p class="cpp-section cpp-topline" style="clear: both">Deep copying</p>
<p>
  One answer to this problem is to do a deep copy on any non-null pointers being
  copied. A <strong>deep copy</strong> allocates memory for the copy and then
  copies the actual value, so that the copy lives in distinct memory from the
  source. This way, the copy and source are distinct and will not affect each
  other in any way. Doing deep copies requires that we write our own copy
  constructors and overloaded assignment operators.
</p>
<p>Let’s go ahead and show how this is done for our MyString class:</p>
<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token comment">// assumes m_data is initialized</span>
<span class="token keyword keyword-void">void</span> <span class="token class-name">MyString</span><span class="token double-colon punctuation">::</span><span class="token function">deepCopy</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-60-close">(</span><span class="token keyword keyword-const">const</span> MyString<span class="token operator">&amp;</span> source<span class="token punctuation brace-round brace-close brace-level-1" id="pair-60-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-71-close">{</span>
    <span class="token comment">// first we need to deallocate any value that this string is holding!</span>
    <span class="token keyword keyword-delete">delete</span><span class="token punctuation brace-square brace-open brace-level-2" id="pair-65-close">[</span><span class="token punctuation brace-square brace-close brace-level-2" id="pair-65-open">]</span> m_data<span class="token punctuation">;</span>

    <span class="token comment">// because m_length is not a pointer, we can shallow copy it</span>
    m_length <span class="token operator">=</span> source<span class="token punctuation">.</span>m_length<span class="token punctuation">;</span>

    <span class="token comment">// m_data is a pointer, so we need to deep copy it if it is non-null</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-61-close">(</span>source<span class="token punctuation">.</span>m_data<span class="token punctuation brace-round brace-close brace-level-2" id="pair-61-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-70-close">{</span>
        <span class="token comment">// allocate memory for our copy</span>
        m_data <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-char">char</span><span class="token punctuation brace-square brace-open brace-level-3" id="pair-66-close">[</span>m_length<span class="token punctuation brace-square brace-close brace-level-3" id="pair-66-open">]</span><span class="token punctuation">;</span>

        <span class="token comment">// do the copy</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation brace-round brace-open brace-level-3" id="pair-62-close">(</span><span class="token keyword keyword-int">int</span> i<span class="token punctuation brace-curly brace-open brace-level-4" id="pair-69-close">{</span> <span class="token number">0</span> <span class="token punctuation brace-curly brace-close brace-level-4" id="pair-69-open">}</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation brace-round brace-close brace-level-3" id="pair-62-open">)</span>
            m_data<span class="token punctuation brace-square brace-open brace-level-3" id="pair-67-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-3" id="pair-67-open">]</span> <span class="token operator">=</span> source<span class="token punctuation">.</span>m_data<span class="token punctuation brace-square brace-open brace-level-3" id="pair-68-close">[</span>i<span class="token punctuation brace-square brace-close brace-level-3" id="pair-68-open">]</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-70-open">}</span>
    <span class="token keyword keyword-else">else</span>
        m_data <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-71-open">}</span>

<span class="token comment">// Copy constructor</span>
<span class="token class-name">MyString</span><span class="token double-colon punctuation">::</span><span class="token function">MyString</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-63-close">(</span><span class="token keyword keyword-const">const</span> MyString<span class="token operator">&amp;</span> source<span class="token punctuation brace-round brace-close brace-level-1" id="pair-63-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-72-close">{</span>
    <span class="token function">deepCopy</span><span class="token punctuation brace-round brace-open brace-level-2" id="pair-64-close">(</span>source<span class="token punctuation brace-round brace-close brace-level-2" id="pair-64-open">)</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-72-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  As you can see, this is quite a bit more involved than a simple shallow copy!
  First, we have to check to make sure source even has a string (line 11). If it
  does, then we allocate enough memory to hold a copy of that string (line 14).
  Finally, we have to manually copy the string (lines 17 and 18).
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_8_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p>
  Now let’s do the overloaded assignment operator. The overloaded assignment
  operator is slightly trickier:
</p>
<div class="code-block code-block-5" style="margin: 8px 0; clear: both"></div>

<div class="code-toolbar">
  <pre
    class="line-numbers language-cpp"
    tabindex="0"
  ><code class="match-braces language-cpp"><span class="token comment">// Assignment operator</span>
MyString<span class="token operator">&amp;</span> MyString<span class="token double-colon punctuation">::</span><span class="token keyword keyword-operator">operator</span><span class="token operator">=</span><span class="token punctuation brace-round brace-open brace-level-1" id="pair-73-close">(</span><span class="token keyword keyword-const">const</span> MyString<span class="token operator">&amp;</span> source<span class="token punctuation brace-round brace-close brace-level-1" id="pair-73-open">)</span>
<span class="token punctuation brace-curly brace-open brace-level-1" id="pair-77-close">{</span>
    <span class="token comment">// check for self-assignment</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation brace-round brace-open brace-level-2" id="pair-74-close">(</span><span class="token keyword keyword-this">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>source<span class="token punctuation brace-round brace-close brace-level-2" id="pair-74-open">)</span>
    <span class="token punctuation brace-curly brace-open brace-level-2" id="pair-76-close">{</span>
        <span class="token comment">// now do the deep copy</span>
        <span class="token function">deepCopy</span><span class="token punctuation brace-round brace-open brace-level-3" id="pair-75-close">(</span>source<span class="token punctuation brace-round brace-close brace-level-3" id="pair-75-open">)</span><span class="token punctuation">;</span>
    <span class="token punctuation brace-curly brace-close brace-level-2" id="pair-76-open">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
<span class="token punctuation brace-curly brace-close brace-level-1" id="pair-77-open">}</span><span aria-hidden="true" class="line-numbers-rows"><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span><span style="height: 16px;"></span></span><span class="line-numbers-sizer" style="display: none;"></span></code></pre>
  <div class="toolbar">
    <div class="toolbar-item">
      <button
        class="copy-to-clipboard-button"
        type="button"
        data-copy-state="copy"
      >
        <span>Copy</span>
      </button>
    </div>
  </div>
</div>
<p>
  Note that our assignment operator is very similar to our copy constructor, but
  there are three major differences:
</p>
<ul>
  <li>We added a self-assignment check.</li>
  <li>We return *this so we can chain the assignment operator.</li>
  <li>
    We need to explicitly deallocate any value that the string is already
    holding (so we don’t have a memory leak when m_data is reallocated later).
    This is handled inside deepCopy().
  </li>
</ul>
<p>
  When the overloaded assignment operator is called, the item being assigned to
  may already contain a previous value, which we need to make sure we clean up
  before we assign memory for new values. For non-dynamically allocated
  variables (which are a fixed size), we don’t have to bother because the new
  value just overwrites the old one. However, for dynamically allocated
  variables, we need to explicitly deallocate any old memory before we allocate
  any new memory. If we don’t, the code will not crash, but we will have a
  memory leak that will eat away our free memory every time we do an assignment!
</p>
<div
  class="google-auto-placed ap_container"
  style="width: 100%; height: auto; clear: both; text-align: center"
>
  <ins
    data-ad-format="auto"
    class="adsbygoogle adsbygoogle-noablate"
    data-ad-client="ca-pub-0588844875925051"
    data-adsbygoogle-status="done"
    style="
      display: block;
      margin: auto;
      background-color: transparent;
      height: 280px;
    "
    ><div
      id="aswift_9_host"
      style="
        border: none;
        height: 280px;
        width: 1027px;
        margin: 0px;
        padding: 0px;
        position: relative;
        visibility: visible;
        background-color: transparent;
        display: inline-block;
      "
    ></div
  ></ins>
</div>
<p class="cpp-section cpp-topline" style="clear: both">The rule of three</p>
<p>
  Remember the rule of three? If a class requires a user-defined destructor,
  copy constructor, or copy assignment operator, then it probably requires all
  three. This is why. If we’re user-defining any of these functions, it’s
  probably because we’re dealing with dynamic memory allocation. We need the
  copy constructor and copy assignment to handle deep copies, and the destructor
  to deallocate memory.
</p>
<p class="cpp-section cpp-topline" style="clear: both">A better solution</p>
<p>
  Classes in the standard library that deal with dynamic memory, such as
  std::string and std::vector, handle all of their memory management, and have
  overloaded copy constructors and assignment operators that do proper deep
  copying. So instead of doing your own memory management, you can just
  initialize or assign them like normal fundamental variables! That makes these
  classes simpler to use, less error-prone, and you don’t have to spend time
  writing your own overloaded functions!
</p>
<p class="cpp-section cpp-topline" style="clear: both">Summary</p>
<ul>
  <li>
    The default copy constructor and default assignment operators do shallow
    copies, which is fine for classes that contain no dynamically allocated
    variables.
  </li>
  <li>
    Classes with dynamically allocated variables need to have a copy constructor
    and assignment operator that do a deep copy.
  </li>
  <li>
    Favor using classes in the standard library over doing your own memory
    management.
  </li>
</ul>
<div class="prevnext">
  <div class="prevnext-inline">
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/overloading-operators-and-function-templates/"
    >
      <div class="nav-button nav-button-next">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-right" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Next lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">21.14</span>Overloading
            operators and function templates
          </div>
        </div>
      </div></a
    >
    <a class="nav-link" href="/">
      <div class="nav-button nav-button-index">
        <div class="nav-button-icon">
          <i class="fa fa-home" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Back to table of contents</div>
        </div>
      </div></a
    >
    <a
      class="nav-link"
      href="https://www.learncpp.com/cpp-tutorial/overloading-the-assignment-operator/"
    >
      <div class="nav-button nav-button-prev">
        <div class="nav-button-icon">
          <i class="fa fa-chevron-circle-left" aria-hidden="true"></i>
        </div>
        <div class="nav-button-text">
          <div class="nav-button-title">Previous lesson</div>
          <div class="nav-button-lesson">
            <span class="nav-button-lesson-number">21.12</span>Overloading the
            assignment operator
          </div>
        </div>
      </div></a
    >
  </div>
</div>
<div class="code-block code-block-10" style="margin: 8px 0; clear: both"></div>
